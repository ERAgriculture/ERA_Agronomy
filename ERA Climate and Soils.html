<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alliance of Bioversity International &amp; CIAT">
<meta name="dcterms.date" content="2025-07-07">

<title>Climate &amp; Soils Data in ERA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ERA Climate and Soils_files/libs/clipboard/clipboard.min.js"></script>
<script src="ERA Climate and Soils_files/libs/quarto-html/quarto.js"></script>
<script src="ERA Climate and Soils_files/libs/quarto-html/popper.min.js"></script>
<script src="ERA Climate and Soils_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ERA Climate and Soils_files/libs/quarto-html/anchor.min.js"></script>
<link href="ERA Climate and Soils_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ERA Climate and Soils_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ERA Climate and Soils_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ERA Climate and Soils_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ERA Climate and Soils_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script async="" src="https://hypothes.is/embed.js"></script>
<script src="ERA Climate and Soils_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="ERA Climate and Soils_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#how-era-connects-to-geospatial-climate-and-soils-data" id="toc-how-era-connects-to-geospatial-climate-and-soils-data" class="nav-link active" data-scroll-target="#how-era-connects-to-geospatial-climate-and-soils-data"><span class="header-section-number">1</span> How ERA Connects to Geospatial Climate and Soils Data</a>
  <ul>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources"><span class="header-section-number">1.1</span> Data Sources</a>
  <ul class="collapse">
  <li><a href="#chirps-rainfall" id="toc-chirps-rainfall" class="nav-link" data-scroll-target="#chirps-rainfall"><span class="header-section-number">1.1.1</span> CHIRPS (Rainfall)</a></li>
  <li><a href="#power-nasa" id="toc-power-nasa" class="nav-link" data-scroll-target="#power-nasa"><span class="header-section-number">1.1.2</span> POWER (NASA)</a></li>
  <li><a href="#soil-data-sources" id="toc-soil-data-sources" class="nav-link" data-scroll-target="#soil-data-sources"><span class="header-section-number">1.2.1</span> Soil Data Sources</a>
  <ul class="collapse">
  <li><a href="#isdasoil-africa-only" id="toc-isdasoil-africa-only" class="nav-link" data-scroll-target="#isdasoil-africa-only"><span class="header-section-number">1.2.1.1</span> iSDAsoil (Africa only)</a></li>
  <li><a href="#soilgrids-2.0-non-africa" id="toc-soilgrids-2.0-non-africa" class="nav-link" data-scroll-target="#soilgrids-2.0-non-africa"><span class="header-section-number">1.2.1.2</span> SoilGrids 2.0 (Non-Africa)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#we-plan-to-extend-soilgrids-2.0-to-african-sites-in-a-future-update-allowing-for-harmonized-coverage-across-all-regions." id="toc-we-plan-to-extend-soilgrids-2.0-to-african-sites-in-a-future-update-allowing-for-harmonized-coverage-across-all-regions." class="nav-link" data-scroll-target="#we-plan-to-extend-soilgrids-2.0-to-african-sites-in-a-future-update-allowing-for-harmonized-coverage-across-all-regions."><span class="header-section-number">1.3</span> &gt; <em>We plan to extend SoilGrids 2.0 to African sites in a future update, allowing for harmonized coverage across all regions.</em></a>
  <ul class="collapse">
  <li><a href="#aez-agro-ecological-zones" id="toc-aez-agro-ecological-zones" class="nav-link" data-scroll-target="#aez-agro-ecological-zones"><span class="header-section-number">1.3.1</span> AEZ (Agro-Ecological Zones)</a></li>
  <li><a href="#elevation-dem" id="toc-elevation-dem" class="nav-link" data-scroll-target="#elevation-dem"><span class="header-section-number">1.3.2</span> Elevation (DEM)</a></li>
  <li><a href="#water-balance-onset-of-rain" id="toc-water-balance-onset-of-rain" class="nav-link" data-scroll-target="#water-balance-onset-of-rain"><span class="header-section-number">1.3.3</span> Water Balance &amp; Onset of Rain</a></li>
  </ul></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods"><span class="header-section-number">1.4</span> Methods</a></li>
  <li><a href="#these-derived-indicators-provide-a-biophysically-relevant-summary-of-climate-exposure-tailored-to-the-actual-growing-period-of-each-crop-making-them-more-actionable-than-raw-daily-data-or-long-term-averages." id="toc-these-derived-indicators-provide-a-biophysically-relevant-summary-of-climate-exposure-tailored-to-the-actual-growing-period-of-each-crop-making-them-more-actionable-than-raw-daily-data-or-long-term-averages." class="nav-link" data-scroll-target="#these-derived-indicators-provide-a-biophysically-relevant-summary-of-climate-exposure-tailored-to-the-actual-growing-period-of-each-crop-making-them-more-actionable-than-raw-daily-data-or-long-term-averages."><span class="header-section-number">1.5</span> These derived indicators provide a <strong>biophysically relevant summary of climate exposure</strong> tailored to the actual growing period of each crop, making them more actionable than raw daily data or long-term averages.</a>
  <ul class="collapse">
  <li><a href="#downloading-the-climate-data" id="toc-downloading-the-climate-data" class="nav-link" data-scroll-target="#downloading-the-climate-data"><span class="header-section-number">1.5.1</span> Downloading the climate data</a></li>
  </ul></li>
  <li><a href="#climate-data-content-and-structure" id="toc-climate-data-content-and-structure" class="nav-link" data-scroll-target="#climate-data-content-and-structure"><span class="header-section-number">1.6</span> Climate data content and structure</a>
  <ul class="collapse">
  <li><a href="#unique-locations-and-times-clim_datasite_data" id="toc-unique-locations-and-times-clim_datasite_data" class="nav-link" data-scroll-target="#unique-locations-and-times-clim_datasite_data"><span class="header-section-number">1.6.1</span> Unique locations and times (<code>clim_data$site_data</code>)</a>
  <ul class="collapse">
  <li><a href="#site-year-season-study" id="toc-site-year-season-study" class="nav-link" data-scroll-target="#site-year-season-study"><span class="header-section-number">1.6.1.1</span> Site, year, season, &amp; study</a></li>
  <li><a href="#crops" id="toc-crops" class="nav-link" data-scroll-target="#crops"><span class="header-section-number">1.6.1.2</span> Crops</a></li>
  <li><a href="#planting-dates" id="toc-planting-dates" class="nav-link" data-scroll-target="#planting-dates"><span class="header-section-number">1.6.1.3</span> Planting dates</a></li>
  <li><a href="#season-length" id="toc-season-length" class="nav-link" data-scroll-target="#season-length"><span class="header-section-number">1.6.1.4</span> Season length</a></li>
  </ul></li>
  <li><a href="#climate-data-pdate.slen.data-pdate.slen.ecocrop-pdate.slen.p30" id="toc-climate-data-pdate.slen.data-pdate.slen.ecocrop-pdate.slen.p30" class="nav-link" data-scroll-target="#climate-data-pdate.slen.data-pdate.slen.ecocrop-pdate.slen.p30"><span class="header-section-number">1.6.2</span> Climate data (<code>PDate.SLen.Data, PDate.SLen.EcoCrop, PDate.SLen.P30</code>)</a>
  <ul class="collapse">
  <li><a href="#shared-fields-index-or-key-fields" id="toc-shared-fields-index-or-key-fields" class="nav-link" data-scroll-target="#shared-fields-index-or-key-fields"><span class="header-section-number">1.6.2.1</span> shared fields (index or key fields)</a></li>
  <li><a href="#gdd" id="toc-gdd" class="nav-link" data-scroll-target="#gdd"><span class="header-section-number">1.6.2.2</span> gdd</a></li>
  <li><a href="#temperature" id="toc-temperature" class="nav-link" data-scroll-target="#temperature"><span class="header-section-number">1.6.2.3</span> temperature</a></li>
  <li><a href="#rainfall" id="toc-rainfall" class="nav-link" data-scroll-target="#rainfall"><span class="header-section-number">1.6.2.4</span> rainfall</a></li>
  <li><a href="#eratio" id="toc-eratio" class="nav-link" data-scroll-target="#eratio"><span class="header-section-number">1.6.2.5</span> eratio</a></li>
  <li><a href="#logging" id="toc-logging" class="nav-link" data-scroll-target="#logging"><span class="header-section-number">1.6.2.6</span> logging</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#connecting-climate-stats-back-to-the-era-database" id="toc-connecting-climate-stats-back-to-the-era-database" class="nav-link" data-scroll-target="#connecting-climate-stats-back-to-the-era-database"><span class="header-section-number">1.7</span> Connecting climate stats back to the ERA database</a>
  <ul class="collapse">
  <li><a href="#era-comparisons-table" id="toc-era-comparisons-table" class="nav-link" data-scroll-target="#era-comparisons-table"><span class="header-section-number">1.7.1</span> ERA Comparisons Table</a></li>
  </ul></li>
  <li><a href="#foundational-datasets" id="toc-foundational-datasets" class="nav-link" data-scroll-target="#foundational-datasets"><span class="header-section-number">1.8</span> Foundational datasets</a>
  <ul class="collapse">
  <li><a href="#rainfall-1" id="toc-rainfall-1" class="nav-link" data-scroll-target="#rainfall-1"><span class="header-section-number">1.8.1</span> Rainfall</a>
  <ul class="collapse">
  <li><a href="#access" id="toc-access" class="nav-link" data-scroll-target="#access"><span class="header-section-number">1.8.1.1</span> Access</a></li>
  <li><a href="#structure" id="toc-structure" class="nav-link" data-scroll-target="#structure"><span class="header-section-number">1.8.1.2</span> Structure</a></li>
  </ul></li>
  <li><a href="#power" id="toc-power" class="nav-link" data-scroll-target="#power"><span class="header-section-number">1.8.2</span> POWER</a>
  <ul class="collapse">
  <li><a href="#access-1" id="toc-access-1" class="nav-link" data-scroll-target="#access-1"><span class="header-section-number">1.8.2.1</span> Access</a></li>
  <li><a href="#structure-1" id="toc-structure-1" class="nav-link" data-scroll-target="#structure-1"><span class="header-section-number">1.8.2.2</span> Structure</a></li>
  </ul></li>
  <li><a href="#soilgrids" id="toc-soilgrids" class="nav-link" data-scroll-target="#soilgrids"><span class="header-section-number">1.8.3</span> Soilgrids</a>
  <ul class="collapse">
  <li><a href="#access-2" id="toc-access-2" class="nav-link" data-scroll-target="#access-2"><span class="header-section-number">1.8.3.1</span> Access</a></li>
  <li><a href="#structure-2" id="toc-structure-2" class="nav-link" data-scroll-target="#structure-2"><span class="header-section-number">1.8.3.2</span> Structure</a></li>
  </ul></li>
  <li><a href="#elevation" id="toc-elevation" class="nav-link" data-scroll-target="#elevation"><span class="header-section-number">1.8.4</span> Elevation</a>
  <ul class="collapse">
  <li><a href="#access-3" id="toc-access-3" class="nav-link" data-scroll-target="#access-3"><span class="header-section-number">1.8.4.1</span> Access</a></li>
  <li><a href="#structure-3" id="toc-structure-3" class="nav-link" data-scroll-target="#structure-3"><span class="header-section-number">1.8.4.2</span> Structure</a></li>
  </ul></li>
  <li><a href="#sos" id="toc-sos" class="nav-link" data-scroll-target="#sos"><span class="header-section-number">1.8.5</span> SOS</a>
  <ul class="collapse">
  <li><a href="#access-4" id="toc-access-4" class="nav-link" data-scroll-target="#access-4"><span class="header-section-number">1.8.5.1</span> Access</a></li>
  <li><a href="#structure-4" id="toc-structure-4" class="nav-link" data-scroll-target="#structure-4"><span class="header-section-number">1.8.5.2</span> Structure</a></li>
  <li><a href="#methods-1" id="toc-methods-1" class="nav-link" data-scroll-target="#methods-1"><span class="header-section-number">1.8.5.3</span> Methods</a></li>
  </ul></li>
  <li><a href="#aez" id="toc-aez" class="nav-link" data-scroll-target="#aez"><span class="header-section-number">1.8.6</span> AEZ</a>
  <ul class="collapse">
  <li><a href="#access-5" id="toc-access-5" class="nav-link" data-scroll-target="#access-5"><span class="header-section-number">1.8.6.1</span> Access</a></li>
  <li><a href="#structure-5" id="toc-structure-5" class="nav-link" data-scroll-target="#structure-5"><span class="header-section-number">1.8.6.2</span> Structure</a></li>
  </ul></li>
  <li><a href="#soil-moisture" id="toc-soil-moisture" class="nav-link" data-scroll-target="#soil-moisture"><span class="header-section-number">1.8.7</span> Soil Moisture</a>
  <ul class="collapse">
  <li><a href="#access-6" id="toc-access-6" class="nav-link" data-scroll-target="#access-6"><span class="header-section-number">1.8.7.1</span> Access</a></li>
  <li><a href="#structure-6" id="toc-structure-6" class="nav-link" data-scroll-target="#structure-6"><span class="header-section-number">1.8.7.2</span> Structure</a></li>
  </ul></li>
  <li><a href="#bioclim" id="toc-bioclim" class="nav-link" data-scroll-target="#bioclim"><span class="header-section-number">1.8.8</span> Bioclim</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements"><span class="header-section-number">2</span> Acknowledgements</a></li>
  <li><a href="#contact-us" id="toc-contact-us" class="nav-link" data-scroll-target="#contact-us"><span class="header-section-number">3</span> Contact Us</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Climate &amp; Soils Data in ERA</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alliance of Bioversity International &amp; CIAT </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div style="display: flex; align-items: center; gap: 20px;">
<p><img src="images/Era_Logo_FINAL_Colour.png" width="100" style="margin-top: 10px;"></p>
</div>
<section id="how-era-connects-to-geospatial-climate-and-soils-data" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> How ERA Connects to Geospatial Climate and Soils Data</h1>
<p><strong>Intended Users</strong></p>
<p>This documentation is intended for technical users working with the ERA meta-dataset who wish to integrate seasonally relevant climate statistics into agronomic observations. Users do not need to rerun the calculations—preprocessed climate data are provided on S3—but may use this guide to understand:</p>
<ul>
<li>What climate indicators were generated</li>
<li>How planting dates and season lengths were determined</li>
<li>Where to find the data and how to merge them with ERA observations</li>
<li>Where to find the code used to generate and process data</li>
</ul>
<p><strong>Background</strong></p>
<p>We developed a geospatial enrichment pipeline to augment ERA’s agronomic experiments with high-resolution climate, soil, and elevation data, linked to specific crops, locations, and growing seasons. Each observation is connected to daily weather time series and soil attributes based on its site coordinates and reported or inferred planting and harvest dates. Where precise dates are unavailable, the pipeline uses a tiered imputation approach—drawing on published planting windows, nearby analogs, and agroclimatic indicators such as rainfall onset—to estimate a plausible growing season. This enables the calculation of detailed climate statistics for the period most relevant to crop development, while excluding records with excessive spatial or temporal uncertainty.</p>
<p>The enrichment process applies only to crop-based experiments. Climate statistics are generated only where both spatial and temporal resolution meet defined quality thresholds—specifically, where the site location is known within 50 km and the cropping calendar can be clearly determined. Records from animal feed experiments, as well as spatially or temporally aggregated data (e.g., regional summaries or multi-year averages), are not included. As a result, only a subset of ERA observations receive climate enrichment—those with sufficient detail to anchor the analysis in a specific place and season.</p>
<section id="data-sources" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="data-sources"><span class="header-section-number">1.1</span> Data Sources</h2>
<p>The ERA pipeline enriches observations with climate, soil, and landscape data using custom functions stored in:</p>
<ul>
<li><a href="https://github.com/CIAT/ERA_dev/tree/main/R/add_geodata"><code>R/add_geodata/</code></a>: main dataset scripts</li>
<li><a href="https://github.com/CIAT/ERA_dev/tree/main/R/add_geodata/functions"><code>R/add_geodata/functions/</code></a>: core download and utility functions</li>
</ul>
<p>Below are the datasets used and the script locations.</p>
<hr>
<section id="chirps-rainfall" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="chirps-rainfall"><span class="header-section-number">1.1.1</span> CHIRPS (Rainfall)</h3>
<ul>
<li><strong>Dataset</strong>: CHIRPS Daily Rainfall</li>
<li><strong>Resolution</strong>: 0.05° (~5.5 km)</li>
<li><strong>Coverage</strong>: Africa and globally, 1981–present</li>
<li><strong>Download Source</strong>: <a href="https://data.chc.ucsb.edu/products/CHIRPS-2.0/global_daily/tifs/p05/"><code>https://data.chc.ucsb.edu/products/CHIRPS-2.0/global_daily/tifs/p05/</code></a></li>
<li><strong>Download Script</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/chirps.R"><code>R/add_geodata/chirps.R</code></a></li>
<li><strong>Download Function</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/functions/download_chirps.R"><code>R/add_geodata/functions/download_chirps.R</code></a><br>
</li>
<li><strong>Notes</strong>: Filenames include the date (e.g.&nbsp;<code>chirps.2023.01.01.tif.gz</code>). Versioning is inferred from file date.</li>
</ul>
<hr>
</section>
<section id="power-nasa" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored"><span class="header-section-number">1.1.2</span> POWER (NASA)</h3>
<ul>
<li><p><strong>Dataset</strong>: NASA POWER (Temperature, Radiation, Wind, etc.)</p></li>
<li><p><strong>Resolution</strong>: 0.5° lat × 0.625° lon</p></li>
<li><p><strong>Coverage</strong>: global, ~1983–present</p></li>
<li><p><strong>Download Source</strong>: NASA POWER API — <code>https://power.larc.nasa.gov/api/temporal/daily/</code><br>
</p></li>
<li><p><strong>Script</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/power.R"><code>R/add_geodata/power.R</code></a><br>
</p></li>
<li><h2 id="download-function-radd_geodatafunctionsdownload_power.r" data-number="1.2" class="anchored" data-anchor-id="power-nasa"><span class="header-section-number">1.2</span> <strong>Download Function</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/functions/download_power.R"><code>R/add_geodata/functions/download_power.R</code></a></h2></li>
</ul>
</section>
<section id="soil-data-sources" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="soil-data-sources"><span class="header-section-number">1.2.1</span> Soil Data Sources</h3>
<p>Soil data are used to estimate key properties like water-holding capacity, which underpin the calculation of climate indicators such as <strong>Eratio</strong> and <strong>waterlogging</strong>. Two soil datasets are used depending on site location:</p>
<section id="isdasoil-africa-only" class="level4" data-number="1.2.1.1">
<h4 data-number="1.2.1.1" class="anchored" data-anchor-id="isdasoil-africa-only"><span class="header-section-number">1.2.1.1</span> iSDAsoil (Africa only)</h4>
<ul>
<li><strong>Dataset</strong>: iSDAsoil<br>
</li>
<li><strong>Resolution</strong>: 30 m<br>
</li>
<li><strong>Coverage</strong>: Sub-Saharan Africa<br>
</li>
<li><strong>Source</strong>: <a href="https://www.isda-africa.com/isdasoil"><code>https://www.isda-africa.com/isdasoil</code></a><br>
</li>
<li><strong>Use</strong>: Used for all <strong>African sites</strong> in ERA. Offers high-resolution predictions of soil texture, carbon, pH, and depth—well-suited to the diversity of African agroecosystems.<br>
</li>
<li><strong>Download Scripts</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/soilgrids.R"><code>soilgrids.R</code></a></li>
</ul>
</section>
<section id="soilgrids-2.0-non-africa" class="level4" data-number="1.2.1.2">
<h4 data-number="1.2.1.2" class="anchored" data-anchor-id="soilgrids-2.0-non-africa"><span class="header-section-number">1.2.1.2</span> SoilGrids 2.0 (Non-Africa)</h4>
<ul>
<li><strong>Dataset</strong>: SoilGrids 2.0 (ISRIC)</li>
<li><strong>Resolution</strong>: 250 m<br>
</li>
<li><strong>Coverage</strong>: Global<br>
</li>
<li><strong>Use</strong>: Applied to <strong>non-African sites</strong> in ERA.</li>
<li><strong>Download Scripts</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/soilgrids2.R"><code>soilgrids2.R</code></a>.</li>
<li><strong>Functions</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/functions/download_soilgrids2.R"><code>download_soilgrids2.R</code></a><br>
</li>
<li><strong>Notes</strong>: Accesses data via <code>soilDB::fetchSoilGrids()</code> and reshapes raster. Outputs CSV summaries per site and variable.</li>
</ul>
</section>
</section>
</section>
<section id="we-plan-to-extend-soilgrids-2.0-to-african-sites-in-a-future-update-allowing-for-harmonized-coverage-across-all-regions." class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="we-plan-to-extend-soilgrids-2.0-to-african-sites-in-a-future-update-allowing-for-harmonized-coverage-across-all-regions."><span class="header-section-number">1.3</span> &gt; <em>We plan to extend SoilGrids 2.0 to African sites in a future update, allowing for harmonized coverage across all regions.</em></h2>
<section id="aez-agro-ecological-zones" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="aez-agro-ecological-zones"><span class="header-section-number">1.3.1</span> AEZ (Agro-Ecological Zones)</h3>
<ul>
<li><strong>Layers Used</strong>:
<ul>
<li><code>AEZ16_CLAS--SSA.tif</code>: from Harvard Dataverse<br>
</li>
<li><code>004_afr-aez_09.tif</code>: from <a href="https://files.africasis.isric.org/aez/004_afr-aez_09.tif">ISRIC server</a></li>
</ul></li>
<li><strong>Script</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/aez.R"><code>R/add_geodata/aez.R</code></a>.</li>
<li><strong>Notes</strong>: The ISRIC AEZ layer is recoded with value-to-label mappings from a CSV.</li>
</ul>
<hr>
</section>
<section id="elevation-dem" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="elevation-dem"><span class="header-section-number">1.3.2</span> Elevation (DEM)</h3>
<ul>
<li><strong>Dataset</strong>: Elevation raster</li>
<li><strong>Download Script</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/elevation.R"><code>R/add_geodata/elevation.R</code></a>.</li>
<li><strong>Notes</strong>: Processed from SRTM or other public sources.</li>
</ul>
<hr>
</section>
<section id="water-balance-onset-of-rain" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="water-balance-onset-of-rain"><span class="header-section-number">1.3.3</span> Water Balance &amp; Onset of Rain</h3>
<ul>
<li><strong>Water Balance</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/water_balance.R"><code>R/add_geodata/water_balance.R</code></a><br>
</li>
<li><strong>Onset Date (Start of Season)</strong>: <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/calculate_sos.R"><code>R/add_geodata/calculate_sos.R</code></a></li>
</ul>
<hr>
</section>
</section>
<section id="methods" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="methods"><span class="header-section-number">1.4</span> Methods</h2>
<p>The <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/generate_climate_stats.R"><code>generate_climate_stats.R</code></a> pipeline constructs crop-specific seasonal windows and computes derived climate indicators for each observation in the ERA agronomy dataset. These indicators are designed to reflect climate conditions experienced <strong>during the growing season</strong>, rather than general climatological conditions.</p>
<p>Each observation is linked to a custom seasonal window based on:</p>
<ul>
<li><strong>Reported Planting and Harvest Dates</strong>: If available, these dates define the crop’s growing period directly.<br>
</li>
<li><strong>Imputed Dates</strong>: Where planting or harvest dates are missing or uncertain, the pipeline estimates plausible values using:
<ul>
<li>Nearby observations (within 1–10 km)<br>
</li>
<li>Published planting calendars<br>
</li>
<li>Agroclimatic thresholds (e.g.&nbsp;start of rainy season based on dekadal CHIRPS rainfall)</li>
</ul></li>
<li><strong>Season Length Estimation</strong>: Season length is either taken from the original dataset, imputed from nearby records, or inferred from EcoCrop definitions of crop cycle duration.</li>
<li><strong>Alternate Windows</strong>: In addition to the main growing period, alternate windows are used for specific purposes:
<ul>
<li><code>PDate.SLen.EcoCrop</code>: uses EcoCrop-inferred season length<br>
</li>
<li><code>PDate.SLen.P30</code>: fixed 30-day window after planting (used to assess early-season climate stress)</li>
</ul></li>
</ul>
<p>These windows allow climate statistics to be calculated <strong>only for periods relevant to crop development</strong>, improving interpretation compared to annual or calendar-based averages.</p>
<p><strong>Climate Statistics Generated</strong></p>
<p>Unlike the foundational datasets (e.g., daily rainfall, temperature, radiation), which provide <strong>raw gridded values</strong>, this pipeline produces <strong>seasonally aggregated statistics</strong> aligned with cropping windows. These include:</p>
<ul>
<li><strong>Temperature</strong>: Mean, max, min, and variability of daily temperatures; heat stress indicators (e.g., number of days &gt;35°C).<br>
</li>
<li><strong>Rainfall</strong>: Total rainfall, dry spell frequency, rainfall adequacy.<br>
</li>
<li><strong>Growing Degree Days (GDD)</strong>: Thermal accumulation across sub-optimal, optimal, and heat-stressed temperature bands.<br>
</li>
<li><strong>Evaporative Ratio (ERatio)</strong>: Daily ratio of actual to potential evapotranspiration — a proxy for drought stress.<br>
</li>
<li><strong>Waterlogging (Logging)</strong>: Estimated soil moisture excess above field capacity, indicating excess moisture risk.<br>
</li>
<li><strong>Dry Spells</strong>: Frequency, length, and timing of low-rainfall periods.</li>
</ul>
<p>Each of these indicators is calculated <strong>per site–season–crop</strong> combination using the daily CHIRPS and POWER datasets and simulated water balance (see <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/water_balance.R"><code>water_balance.R</code></a>).</p>
</section>
<section id="these-derived-indicators-provide-a-biophysically-relevant-summary-of-climate-exposure-tailored-to-the-actual-growing-period-of-each-crop-making-them-more-actionable-than-raw-daily-data-or-long-term-averages." class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="these-derived-indicators-provide-a-biophysically-relevant-summary-of-climate-exposure-tailored-to-the-actual-growing-period-of-each-crop-making-them-more-actionable-than-raw-daily-data-or-long-term-averages."><span class="header-section-number">1.5</span> These derived indicators provide a <strong>biophysically relevant summary of climate exposure</strong> tailored to the actual growing period of each crop, making them more actionable than raw daily data or long-term averages.</h2>
<section id="downloading-the-climate-data" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="downloading-the-climate-data"><span class="header-section-number">1.5.1</span> Downloading the climate data</h3>
<p>To access the climate statistics generated for ERA observations, download the harmonized <code>.RData</code> file from the geodata directory on S3:</p>
<ul>
<li><strong>S3 location</strong>: <code>s3://digital-atlas/era/geodata/clim_stats_2025-03-18.RData</code></li>
<li><strong>Content</strong>: This file contains daily and seasonal climate summaries per site, ready to be joined with ERA observations.</li>
</ul>
<p>You can download the file using the <code>s3fs</code> interface as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the remote S3 path and local save path</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>s3_data_dir <span class="ot">&lt;-</span> <span class="st">"s3://digital-atlas/era/geodata"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>local_data_dir <span class="ot">&lt;-</span> <span class="st">"downloaded_data"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># List and filter files</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>s3<span class="ot">&lt;-</span>s3fs<span class="sc">::</span>S3FileSystem<span class="sc">$</span><span class="fu">new</span>(<span class="at">anonymous =</span> T)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"clim_stats.*RData"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>(files_s3 <span class="ot">&lt;-</span> <span class="fu">tail</span>(files_s3, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/clim_stats_2025-04-14.1.RData"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create local file path and download</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, files_s3)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local)){</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>s3<span class="sc">$</span><span class="fu">file_download</span>(files_s3, files_local)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once downloaded, load the .RData file using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the harmonized climate data into your environment</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>clim_data <span class="ot">&lt;-</span> miceadds<span class="sc">::</span><span class="fu">load.Rdata2</span>(<span class="at">file =</span> <span class="fu">basename</span>(files_local), <span class="at">path =</span> <span class="fu">dirname</span>(files_local))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="climate-data-content-and-structure" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="climate-data-content-and-structure"><span class="header-section-number">1.6</span> Climate data content and structure</h2>
<p><code>clim_dat</code> is a named list of data tables, created by <code>generate_climate_stats.R</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(clim_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "PDate.SLen.Data"    "PDate.SLen.EcoCrop" "PDate.SLen.P30"    
[4] "site_data"         </code></pre>
</div>
</div>
<p><strong><code>site_data</code></strong>: contains the spatial and temporal location data for which climate statistic are generated.</p>
<p><strong><code>PDate.SLen.Data, PDate.SLen.EcoCrop,PDate.SLen.P30</code></strong>: these objects are lists of output climate data calculated for for different parameterizations of season length.</p>
<section id="unique-locations-and-times-clim_datasite_data" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="unique-locations-and-times-clim_datasite_data"><span class="header-section-number">1.6.1</span> Unique locations and times (<code>clim_data$site_data</code>)</h3>
<p><code>site_data</code> contains the unique combinations of site, time, crop, planting date, and harvest date from the ERA agronomy dataset.</p>
<section id="site-year-season-study" class="level4" data-number="1.6.1.1">
<h4 data-number="1.6.1.1" class="anchored" data-anchor-id="site-year-season-study"><span class="header-section-number">1.6.1.1</span> Site, year, season, &amp; study</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">unique</span>(clim_data<span class="sc">$</span>site_data[,.(Site.Key,Code,M.Year,Latitude,Longitude,M.Year,M.Year.Code,M.Season)]))<span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Code</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">M.Year</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Latitude</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Longitude</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">M.Year</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">M.Year.Code</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">M.Season</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">NN0381</td>
<td style="text-align: left;">2010</td>
<td style="text-align: right;">-0.00230</td>
<td style="text-align: right;">34.59390</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">LM0251</td>
<td style="text-align: left;">1987</td>
<td style="text-align: right;">-0.00230</td>
<td style="text-align: right;">34.59390</td>
<td style="text-align: left;">1987</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0108 36.9617 B250</td>
<td style="text-align: left;">LM0235</td>
<td style="text-align: left;">2002.1</td>
<td style="text-align: right;">-0.01083</td>
<td style="text-align: right;">36.96167</td>
<td style="text-align: left;">2002.1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0420 34.5920 B12500</td>
<td style="text-align: left;">LM0267</td>
<td style="text-align: left;">1990.2</td>
<td style="text-align: right;">-0.04200</td>
<td style="text-align: right;">34.59200</td>
<td style="text-align: left;">1990.2</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0420 34.5920 B12500</td>
<td style="text-align: left;">LM0267</td>
<td style="text-align: left;">1991.1</td>
<td style="text-align: right;">-0.04200</td>
<td style="text-align: right;">34.59200</td>
<td style="text-align: left;">1991.1</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0420 34.5920 B12500</td>
<td style="text-align: left;">LM0267</td>
<td style="text-align: left;">1991.2</td>
<td style="text-align: right;">-0.04200</td>
<td style="text-align: right;">34.59200</td>
<td style="text-align: left;">1991.2</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>Field Descriptions:</strong></p>
<ul>
<li><code>Site.Key</code>: A unique identifier for each site or location. It is used to link locations consistently across datasets.<br>
</li>
<li><code>Code</code>: A unique code used to identify a publication or entry in the ERA dataset. It serves as the main key for tracking a specific experiment/publication across associated tables.<br>
</li>
<li><code>M.Year</code>: Measurement year – a code that identifies the production season, typically aligned with the <code>Time</code> field in the main ERA dataset. This may take the form of a calendar year or include other formatting to distinguish multiple seasons per year.<br>
</li>
<li>`Latitude: Geographic latitude of the site in decimal degrees (WGS84). Used for spatial analyses and mapping.<br>
</li>
<li><code>Longitude</code>: Geographic longitude of the site in decimal degrees (WGS84). Used for spatial analyses and mapping.<br>
</li>
<li><code>M.Year.Code</code>: A standardized or formatted version of <code>M.Year</code>, often combining year and season. Useful for indexing and subsetting.<br>
</li>
<li><code>M.Season</code>: Management season (typically <code>1</code> or <code>2</code>) indicating the cropping season within a year. May be <code>NA</code> in unimodal systems; helps distinguish multiple cropping events in bimodal climates.</li>
</ul>
</section>
<section id="crops" class="level4" data-number="1.6.1.2">
<h4 data-number="1.6.1.2" class="anchored" data-anchor-id="crops"><span class="header-section-number">1.6.1.2</span> Crops</h4>
<p>These fields contain thresholds that define a crop’s temperature response curve and come from EcoCrop. They can also be used to calculate growing degree days, stress indices, or suitability zones under historical or future climate conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">unique</span>(clim_data<span class="sc">$</span>site_data[,.(Product,EU,Topt.low,Topt.high,Tlow,Thigh)]))<span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Product</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">EU</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Topt.low</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Topt.high</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Tlow</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Thigh</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">c7</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">47</td>
</tr>
<tr class="even">
<td style="text-align: left;">Common Bean</td>
<td style="text-align: left;">h14</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sorghum</td>
<td style="text-align: left;">c13</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="even">
<td style="text-align: left;">Potato</td>
<td style="text-align: left;">i7</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Soybean</td>
<td style="text-align: left;">h13</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tomato (Total Yield)</td>
<td style="text-align: left;">e27.1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">35</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>Field Descriptions:</strong></p>
<ul>
<li><code>Product</code>: The name of the crop or agricultural product (e.g., maize, beans) associated with the management and outcome data.<br>
</li>
<li><code>EU</code>: Experimental Unit code links to the <code>era_master_codes$EU</code> table.<br>
</li>
<li><code>Tlow</code>: The <strong>minimum temperature threshold</strong> for crop development. Below this value, crop growth is assumed to be negligible or halted. Often derived from EcoCrop or agronomic sources.<br>
</li>
<li><code>Thigh</code>: The <strong>maximum temperature threshold</strong> for crop development. Temperatures above this can lead to heat stress or failure in development.<br>
</li>
<li><code>Topt.low</code>: The <strong>lower bound of the optimal temperature range</strong> for crop growth. Within this and <code>Topt.high</code>, the crop achieves near-optimal physiological performance.<br>
</li>
<li><code>Topt.high</code>: The <strong>upper bound of the optimal temperature range</strong> for crop growth. Growth efficiency typically declines beyond this value, even if not fully stressed.</li>
</ul>
<p>These thresholds define a crop’s temperature response curve and come from EcoCrop. They can also be used to calculate growing degree days, stress indices, or suitability zones under historical or future climate conditions.</p>
</section>
<section id="planting-dates" class="level4" data-number="1.6.1.3">
<h4 data-number="1.6.1.3" class="anchored" data-anchor-id="planting-dates"><span class="header-section-number">1.6.1.3</span> Planting dates</h4>
<p><code>site_data</code> contains information about planting dates and their estimation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clim_data<span class="sc">$</span>site_data[,.(Plant.Start,Plant.End,Plant.Diff.Raw,Data.PS.Date,Data.PE.Date,SOS,P.Date.Merge,P.Date.Merge.Source)])<span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.End</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Plant.Diff.Raw</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Data.PS.Date</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Data.PE.Date</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">SOS</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">P.Date.Merge</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">P.Date.Merge.Source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">14690</td>
<td style="text-align: left;">As_published</td>
</tr>
<tr class="even">
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">6280</td>
<td style="text-align: left;">As_published</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">6280</td>
<td style="text-align: left;">As_published</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002-02-15</td>
<td style="text-align: left;">2002-04-15</td>
<td style="text-align: right;">59</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">11754</td>
<td style="text-align: left;">As_published CHIRPS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-07-15</td>
<td style="text-align: left;">1990-09-15</td>
<td style="text-align: right;">62</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">7541</td>
<td style="text-align: left;">As_published CHIRPS</td>
</tr>
<tr class="even">
<td style="text-align: left;">1991-02-15</td>
<td style="text-align: left;">1991-05-15</td>
<td style="text-align: right;">89</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">7744</td>
<td style="text-align: left;">As_published CHIRPS</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>Field Descriptions:</strong></p>
<ul>
<li><code>Plant.Start</code>: The reported start date for planting. This indicates when the planting period began according to the original data.</li>
<li><code>Plant.End</code>: The reported end date for planting. This marks the conclusion of the planting period in the original dataset.</li>
<li><code>Plant.Diff.Raw</code>: The difference (in days) between <code>Plant.Start</code> and <code>Plant.End</code>—indicating how uncertain the reported planting window was.</li>
<li><code>Data.PS.Date</code>: The estimated start date for planting, inferred from nearby or similar observations in ERA when a reported planting date is missing or uncertain.</li>
<li><code>Data.PE.Date</code>: The estimated end date for planting, derived using the same method as Data.PS.Date to define a plausible planting window.</li>
<li><code>SOS</code>: The estimated Start of Season date, derived from daily climate data using agroclimatic thresholds (e.g.&nbsp;rainfall ≥25 mm in a dekad and ≥20 mm in the following two dekads, with aridity index AI ≥ 0.5). It marks when planting conditions were first met based on climatic signals.</li>
<li><code>P.Date.Merge</code>: The final, merged planting date calculated by the pipeline. It represents a consolidated planting date that may incorporate adjustments or estimations (for example, averaging the planting window or refining it using rainfall data). It should be interpreted as the number of days since <code>1900-01-01</code>.</li>
<li><code>P.Date.Merge.Source</code>: A descriptive label indicating the source or method used to derive the merged planting date. This might indicate whether the date was taken directly from published data (e.g., “Published”) or estimated using spatial or rainfall data (e.g., “Nearby 1km”, “SOS + Published”, etc.).</li>
</ul>
<p><strong>Explanation of <code>P.Date.Merge.Source</code> values:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>clim_data<span class="sc">$</span>site_data[,<span class="fu">unique</span>(P.Date.Merge.Source)]<span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">As_published</td>
</tr>
<tr class="even">
<td style="text-align: left;">As_published CHIRPS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NearbySeason_10km_Product ±42d CHIRPS</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nearby_SameYear&amp;Season 1km</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NearbySeason_1km_Product ±42d CHIRPS</td>
</tr>
<tr class="even">
<td style="text-align: left;">SiteSeason_Product ±42d CHIRPS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SOS + As_published CHIRPS</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nearby_SameYear&amp;Season 1km CHIRPS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nearby_SameYear&amp;Season 10km CHIRPS</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nearby_SameYear&amp;Season 10km</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SOS + Nearby_SameYear&amp;Season 10km CHIRPS</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>Values below are presented in order of preference when estimating planting date in the <code>P.Date.Merge</code> field:</p>
<ul>
<li><code>Published</code>: The planting date was directly reported in the original study with no need for estimation.<br>
</li>
<li><code>Published CHIRPS</code>: A published planting date was available but was refined or verified using CHIRPS rainfall data.<br>
</li>
<li><code>Nearby 1km CHIRPS</code> : The estimation was based on observations from locations within a 1‑km radius, with additional refinement using CHIRPS data.<br>
</li>
<li><code>Nearby 10km CHIRPS</code>: As with the 10‑km estimation, this method further incorporated CHIRPS rainfall data to improve the estimate.<br>
</li>
<li><code>Nearby 1km</code>: Similar to the CHIRPS-based 1‑km estimate but without the additional rainfall data refinement.<br>
</li>
<li><code>Nearby 10km</code>: The planting date was estimated from nearby observations aggregated over a 10‑km radius due to missing or uncertain reported dates.<br>
</li>
<li><code>SOS + Published</code>: The planting date was adjusted using SOS information in cases where the published date was uncertain, without incorporating CHIRPS data.<br>
</li>
<li><code>SOS + Published CHIRPS</code>: When the reported planting date (Published) was too uncertain, the method adjusted it using the Start‐of‐Season (SOS) rainfall onset data alongside CHIRPS information.</li>
</ul>
<p>This hierarchy reflects a logical preference: <strong>Directly observed data &gt; Nearby analogues &gt; Climatological estimation</strong>.</p>
</section>
<section id="season-length" class="level4" data-number="1.6.1.4">
<h4 data-number="1.6.1.4" class="anchored" data-anchor-id="season-length"><span class="header-section-number">1.6.1.4</span> Season length</h4>
<p><code>site_data</code> contains information about reported harvest dates and season length. Season length may use the reported dates or be estimated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clim_data<span class="sc">$</span>site_data[,.(Harvest.Start,Harvest.End,SLen,Data.SLen,SLen.EcoCrop,SLen.Source,SeasonLength.Data,SeasonLength.EcoCrop)])<span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.End</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">SLen</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Data.SLen</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">SLen.EcoCrop</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">SLen.Source</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">SeasonLength.Data</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">SeasonLength.EcoCrop</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: right;">140</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">135</td>
<td style="text-align: left;">As_published + Published</td>
<td style="text-align: right;">140</td>
<td style="text-align: right;">135</td>
</tr>
<tr class="even">
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: right;">153</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">135</td>
<td style="text-align: left;">As_published + Published</td>
<td style="text-align: right;">153</td>
<td style="text-align: right;">135</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">101</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">101</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">135</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">135</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">135</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">135</td>
</tr>
<tr class="even">
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">135</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">135</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>Field Descriptions:</strong></p>
<ul>
<li><code>Harvest.Start</code>: The reported or estimated date when harvest began. Typically reflects the first day of the harvest window.</li>
<li><code>Harvest.End</code>: The reported or estimated date when harvest concluded. Typically reflects the last day of the harvest window.</li>
<li><code>SLen</code>: Season Length – calculated as the number of days between <code>Plant.Start</code> and <code>Harvest.End</code>. Represents the observed or estimated duration of the cropping cycle.</li>
<li><code>Data.SLen</code>: Season Length derived from reported data only (i.e., <code>Plant.Start</code> and <code>Harvest.End</code> must both be available from original records). Used to indicate where the season length is based on direct evidence rather than estimates.</li>
<li><code>SLen.EcoCrop</code>: An estimate of cropping cycle length derived from the EcoCrop database refined using data available in ERA where possible. Used as a fallback when data-derived values are missing. <code>SeasonLength.EcoCrop</code> is redundant and contains the same information as <code>SLen.EcoCrop</code>.</li>
<li><code>SLen.Source</code>: This field indicates how the final <strong>Season Length</strong> (<code>SeasonLength.Data</code> field) used in calculations was derived, based on the origin of planting and harvest date estimates. The format is:<code>&lt;Planting Source&gt; + &lt;Season Length Source&gt;</code>.</li>
<li><code>SeasonLength.Data</code>: Combines <code>SLen</code> and <code>Data.SLen</code> fields, substituting values <code>Data.SLen</code> when <code>SLen</code> is <code>NA.</code></li>
</ul>
<p><strong>Explanation of SLen.Source values:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>clim_data<span class="sc">$</span>site_data[,<span class="fu">unique</span>(SLen.Source)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "As_published + Published"                        
 [2] NA                                                
 [3] "CHIRPS As_published + Published"                 
 [4] "As_published + SLen Nearby 1km"                  
 [5] "Nearby_SameYear&amp;Season 1km + Published"          
 [6] "Nearby_SameYear&amp;Season 1km + SLen Nearby 1km"    
 [7] "SiteSeason_Product ±42d + SLen Nearby 1km"       
 [8] "NearbySeason_10km_Product ±42d + SLen Nearby 1km"
 [9] "SOS + As_published + Nearby 1km"                 
[10] "As_published + SLen Nearby 10km"                 
[11] "Nearby_SameYear&amp;Season 1km + SLen Nearby 10km"   
[12] "CHIRPS SOS + As_published + Pub"                 
[13] "Nearby_SameYear&amp;Season 10km + SLen Nearby 1km"   
[14] "NearbySeason_1km_Product ±42d + SLen Nearby 1km" 
[15] "NearbySeason_1km_Product ±42d + SLen Nearby 10km"
[16] "CHIRPS SiteSeason_Product ±42d + SLen Nearby 1km"</code></pre>
</div>
</div>
<p>The format of <code>SLen.Source</code> is <code>&lt;Planting Source&gt; + &lt;Season Length Source&gt;</code> and the order of preference for the season length source is the same as for planting. Observed values include:<br>
- <code>Published + Pub</code> – Both planting and harvest dates are reported with low uncertainty in the publication.<br>
- <code>Published + Nearby 1km</code> – Planting date reported with low uncertainty; season length estimated from nearby (within 1 km) observations.<br>
- <code>CHIRPS Published + Pub</code> – Planting date reported, but uncertain, and refined using CHIRPS rainfall; harvest dates reported with low uncertainty.<br>
- <code>Nearby 1km + Nearby 1km</code> – Both planting date and season length derived from nearby (within 1 km) observations.<br>
- <code>Nearby 1km + Nearby 10km</code> – Planting date from 1 km radius; season length from 10 km radius.<br>
- <code>SOS + Published + Nearby 1km</code> –The planting date was adjusted using SOS information in cases where the published date was uncertain, without incorporating CHIRPS data; season length from nearby data.<br>
- <code>CHIRPS SOS + Published + Pub</code> – When the reported planting date (Published) was too uncertain, the method adjusted it using the Start‐of‐Season (SOS) rainfall onset data alongside CHIRPS information; harvest dates reported with low uncertainty.<br>
- <code>Published + Nearby 10km</code> – Planting date reported with low uncertainty; season length from 10 km proximity.<br>
- <code>Nearby 1km + Pub</code> – Planting data from nearby; harvest dates reported with low uncertainty.<br>
- <code>Nearby 10km + Nearby 1km</code> – Planting data from nearby;season length from 10 km proximity.<br>
- <code>NA</code> – No season length estimate was available or derived.</p>
<p>These combinations trace the logical fallback and merging sequence for generating season length when direct data are missing or uncertain.</p>
<p>These can be merged with ERA observation data using the Site.ID and Time fields.</p>
</section>
</section>
<section id="climate-data-pdate.slen.data-pdate.slen.ecocrop-pdate.slen.p30" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="climate-data-pdate.slen.data-pdate.slen.ecocrop-pdate.slen.p30"><span class="header-section-number">1.6.2</span> Climate data (<code>PDate.SLen.Data, PDate.SLen.EcoCrop, PDate.SLen.P30</code>)</h3>
<p>Each of these climate window datasets contains a set of summary tables—one per climate indicator (e.g., temperature, rainfall, GDD)—with statistics calculated over the defined seasonal window for every crop-site-season combination that passed quality filters.</p>
<p><strong><code>PDate.SLen.Data</code></strong> : <code>site_data$P.Date.Merge</code> and <code>site_data$SeasonLength.Data</code> are used to determine the start and end dates within which climate statistics are calculated. If season length is not reported or cannot be inferred from ERA data for a row in <code>site_data</code> then no climate stats will be generated for that record.</p>
<p><strong><code>PDate.SLen.EcoCrop</code></strong> <code>site_data$P.Date.Merge</code> and <code>site_data$SLen.EcoCrop</code> are used to determine the start and end dates within which climate statistics are calculated. Season length is inferred from the midpoint of ecocrop cycle length for a crop, refined where possible using reported values within the ERA dataset. This dataset therefore inputes missing season length and contains more records than <code>PDate.SLen.Data</code>,however season length is likely to be less accurate.</p>
<p><strong><code>PDate.SLen.P30</code></strong> <code>site_data$P.Date.Merge</code> is used to determine the start date of the climate window, and the end date is fixed to 30 days after planting. This represent the post-planting climate, which can be a particularly sensitive period for many crops.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(clim_data<span class="sc">$</span>PDate.SLen.Data)<span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">gdd</td>
</tr>
<tr class="even">
<td style="text-align: left;">temperature</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rainfall</td>
</tr>
<tr class="even">
<td style="text-align: left;">eratio</td>
</tr>
<tr class="odd">
<td style="text-align: left;">logging</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>Each of the following names corresponds to a list of <strong>climate statistics</strong> calculated over the seasonal window defined by <code>P.Date.Merge</code> and <code>SeasonLength.Data</code>:</p>
<ul>
<li><p><strong><code>gdd</code></strong>: Growing Degree Days — cumulative heat units over the season binned into thermal stress classes, useful for crop development and heat stress exposure tracking.</p></li>
<li><p><strong><code>temperature</code></strong>: Mean, minimum, and maximum temperatures over the season. Consecutive and total days above/below temperature thresholds.</p></li>
<li><p><strong><code>rainfall</code></strong>: Total and average precipitation during the season. Consecutive and total days above/below precipitation thresholds.</p></li>
<li><p><strong><code>eratio</code></strong>: Ratio of rainfall to reference evapotranspiration — a proxy for water availability or drought stress.</p></li>
<li><p><strong><code>logging</code></strong>: Days with waterlogging risk — based on rainfall thresholds that may indicate excess moisture conditions.</p></li>
</ul>
<p>Each object is a <code>data.table</code> with one row per Site.ID and columns containing summary statistics for that climate indicator.</p>
<section id="shared-fields-index-or-key-fields" class="level4" data-number="1.6.2.1">
<h4 data-number="1.6.2.1" class="anchored" data-anchor-id="shared-fields-index-or-key-fields"><span class="header-section-number">1.6.2.1</span> shared fields (index or key fields)</h4>
<p>These fields are needed for merging the climate statistics back to the ERA comparisons table.</p>
<p>All tables share these fields:<br>
- <strong><code>Site.Key</code></strong>: The site identifier for spatially reconnecting to the ERA comparisons table.<br>
- <strong><code>M.Year</code></strong>: The time period identifier for temporally reconnecting to the ERA comparisions table.<br>
- <strong><code>EU</code></strong>: The crop or animal product code. - <strong><code>Product</code></strong>: The crop or animal product name (this corresponds to the <code>Product.Simple</code> name field in ther ERA comparisons table) - <strong><code>Plant.Start</code></strong>: The original planting start date (as per the ERA comparisons table raw data).<br>
- <strong><code>Plant.End</code></strong>: The original planting end date (as per the ERA comparisons table raw data).<br>
- <strong><code>Harvest.Start</code></strong>: The original harvest start date (as per the ERA comparisons table raw data).<br>
- <strong><code>Harvest.End</code></strong>: The original harvest end date (as per the ERA comparisons table raw data).</p>
<p>Additionally these shared fields are present: - <strong><code>window</code></strong>: Description of window used, useful if merging tables that use different climate window calculation methods.<br>
- <strong><code>row_index</code></strong> : Internal index to link this row back to the corresponding entry in the <code>site_data</code> table.</p>
</section>
<section id="gdd" class="level4" data-number="1.6.2.2">
<h4 data-number="1.6.2.2" class="anchored" data-anchor-id="gdd"><span class="header-section-number">1.6.2.2</span> gdd</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clim_data<span class="sc">$</span>PDate.SLen.Data<span class="sc">$</span>gdd)<span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">gdd_subopt</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">gdd_opt</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">gdd_aboveopt</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">gdd_abovemax</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">row_index</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">M.Year</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">EU</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Product</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">window</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">58.95</td>
<td style="text-align: right;">1659.66</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">132.65</td>
<td style="text-align: right;">1702.52</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1987</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="odd">
<td style="text-align: right;">282.48</td>
<td style="text-align: right;">934.64</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">2001.2</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2001-10-01</td>
<td style="text-align: left;">2001-10-30</td>
<td style="text-align: left;">2002-02-01</td>
<td style="text-align: left;">2002-02-28</td>
<td style="text-align: left;">-0.0833 37.0000 B917</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">234.85</td>
<td style="text-align: right;">715.74</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">2002.1</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2002-04-01</td>
<td style="text-align: left;">2002-04-30</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">-0.0833 37.0000 B917</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="odd">
<td style="text-align: right;">424.50</td>
<td style="text-align: right;">949.32</td>
<td style="text-align: right;">52.95</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">60</td>
<td style="text-align: left;">2004</td>
<td style="text-align: left;">c14</td>
<td style="text-align: left;">Wheat</td>
<td style="text-align: left;">2004-05-25</td>
<td style="text-align: left;">2004-05-25</td>
<td style="text-align: left;">2004-10-07</td>
<td style="text-align: left;">2004-10-07</td>
<td style="text-align: left;">-0.3780 35.9890 B500</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">457.86</td>
<td style="text-align: right;">1011.53</td>
<td style="text-align: right;">61.63</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">61</td>
<td style="text-align: left;">2005</td>
<td style="text-align: left;">c14</td>
<td style="text-align: left;">Wheat</td>
<td style="text-align: left;">2005-05-14</td>
<td style="text-align: left;">2005-05-14</td>
<td style="text-align: left;">2005-10-02</td>
<td style="text-align: left;">2005-10-02</td>
<td style="text-align: left;">-0.3780 35.9890 B500</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>This table contains Growing Degree Day (GDD) statistics calculated over the defined season window for each site. Here’s what each field represents:<br>
- <strong><code>gdd_subopt</code></strong>: Cumulative GDD within the <strong>sub-optimal temperature range</strong> for crop growth (above base temperature but below optimal).<br>
- <strong><code>gdd_opt</code></strong>: Cumulative GDD within the <strong>optimal temperature range</strong> — where the crop is expected to grow most efficiently.<br>
- <strong><code>gdd_aboveopt</code></strong>: Cumulative GDD in the <strong>above-optimal range</strong>, where temperatures may begin to reduce growth efficiency.<br>
- <strong><code>gdd_abovemax</code></strong>: Cumulative GDD <strong>above the maximum threshold</strong>, indicating <strong>heat stress</strong> or potentially damaging conditions.</p>
</section>
<section id="temperature" class="level4" data-number="1.6.2.3">
<h4 data-number="1.6.2.3" class="anchored" data-anchor-id="temperature"><span class="header-section-number">1.6.2.3</span> temperature</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clim_data<span class="sc">$</span>PDate.SLen.Data<span class="sc">$</span>temperature) <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.max_rseq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.max_rseq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.max_rseq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmin_min</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmin_mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmin_var</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmin_sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmin_range</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_max</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_var</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_range</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_max</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_min</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_var</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_range</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">row_index</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">M.Year</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">EU</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Product</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">window</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">15.50</td>
<td style="text-align: right;">18.476809</td>
<td style="text-align: right;">0.8375705</td>
<td style="text-align: right;">0.9151888</td>
<td style="text-align: right;">5.09</td>
<td style="text-align: right;">30.58</td>
<td style="text-align: right;">26.18730</td>
<td style="text-align: right;">2.720730</td>
<td style="text-align: right;">1.649463</td>
<td style="text-align: right;">8.60</td>
<td style="text-align: right;">24.69</td>
<td style="text-align: right;">19.63</td>
<td style="text-align: right;">22.00830</td>
<td style="text-align: right;">0.9936999</td>
<td style="text-align: right;">0.9968450</td>
<td style="text-align: right;">5.06</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">15.39</td>
<td style="text-align: right;">17.872208</td>
<td style="text-align: right;">0.8065650</td>
<td style="text-align: right;">0.8980897</td>
<td style="text-align: right;">5.74</td>
<td style="text-align: right;">32.20</td>
<td style="text-align: right;">26.27351</td>
<td style="text-align: right;">6.365606</td>
<td style="text-align: right;">2.523015</td>
<td style="text-align: right;">10.89</td>
<td style="text-align: right;">25.41</td>
<td style="text-align: right;">19.00</td>
<td style="text-align: right;">21.75870</td>
<td style="text-align: right;">1.8366676</td>
<td style="text-align: right;">1.3552371</td>
<td style="text-align: right;">6.41</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1987</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">9.10</td>
<td style="text-align: right;">11.624133</td>
<td style="text-align: right;">1.4849358</td>
<td style="text-align: right;">1.2185794</td>
<td style="text-align: right;">5.24</td>
<td style="text-align: right;">29.41</td>
<td style="text-align: right;">25.09500</td>
<td style="text-align: right;">3.614292</td>
<td style="text-align: right;">1.901129</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">19.75</td>
<td style="text-align: right;">15.91</td>
<td style="text-align: right;">17.69460</td>
<td style="text-align: right;">0.7627982</td>
<td style="text-align: right;">0.8733832</td>
<td style="text-align: right;">3.84</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">2001.2</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2001-10-01</td>
<td style="text-align: left;">2001-10-30</td>
<td style="text-align: left;">2002-02-01</td>
<td style="text-align: left;">2002-02-28</td>
<td style="text-align: left;">-0.0833 37.0000 B917</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">9.29</td>
<td style="text-align: right;">11.624065</td>
<td style="text-align: right;">1.7777506</td>
<td style="text-align: right;">1.3333231</td>
<td style="text-align: right;">6.09</td>
<td style="text-align: right;">26.77</td>
<td style="text-align: right;">24.29724</td>
<td style="text-align: right;">1.467853</td>
<td style="text-align: right;">1.211550</td>
<td style="text-align: right;">6.54</td>
<td style="text-align: right;">18.63</td>
<td style="text-align: right;">15.65</td>
<td style="text-align: right;">17.36220</td>
<td style="text-align: right;">0.4043255</td>
<td style="text-align: right;">0.6358659</td>
<td style="text-align: right;">2.98</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">2002.1</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2002-04-01</td>
<td style="text-align: left;">2002-04-30</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">-0.0833 37.0000 B917</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.19</td>
<td style="text-align: right;">9.939118</td>
<td style="text-align: right;">1.5819044</td>
<td style="text-align: right;">1.2577378</td>
<td style="text-align: right;">5.36</td>
<td style="text-align: right;">25.11</td>
<td style="text-align: right;">21.47147</td>
<td style="text-align: right;">2.016235</td>
<td style="text-align: right;">1.419942</td>
<td style="text-align: right;">6.76</td>
<td style="text-align: right;">17.57</td>
<td style="text-align: right;">13.45</td>
<td style="text-align: right;">15.46684</td>
<td style="text-align: right;">0.6721388</td>
<td style="text-align: right;">0.8198407</td>
<td style="text-align: right;">4.12</td>
<td style="text-align: right;">60</td>
<td style="text-align: left;">2004</td>
<td style="text-align: left;">c14</td>
<td style="text-align: left;">Wheat</td>
<td style="text-align: left;">2004-05-25</td>
<td style="text-align: left;">2004-05-25</td>
<td style="text-align: left;">2004-10-07</td>
<td style="text-align: left;">2004-10-07</td>
<td style="text-align: left;">-0.3780 35.9890 B500</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.37</td>
<td style="text-align: right;">10.546338</td>
<td style="text-align: right;">1.6467624</td>
<td style="text-align: right;">1.2832624</td>
<td style="text-align: right;">6.58</td>
<td style="text-align: right;">25.80</td>
<td style="text-align: right;">21.42162</td>
<td style="text-align: right;">2.694102</td>
<td style="text-align: right;">1.641372</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">17.54</td>
<td style="text-align: right;">13.63</td>
<td style="text-align: right;">15.64239</td>
<td style="text-align: right;">0.6342666</td>
<td style="text-align: right;">0.7964085</td>
<td style="text-align: right;">3.91</td>
<td style="text-align: right;">61</td>
<td style="text-align: left;">2005</td>
<td style="text-align: left;">c14</td>
<td style="text-align: left;">Wheat</td>
<td style="text-align: left;">2005-05-14</td>
<td style="text-align: left;">2005-05-14</td>
<td style="text-align: left;">2005-10-02</td>
<td style="text-align: left;">2005-10-02</td>
<td style="text-align: left;">-0.3780 35.9890 B500</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>This table summarizes temperature-related climate statistics. Fields fall into two main categories:</p>
<p><strong>1. Heat Stress Threshold Indicators (<code>tmax_tg_*</code>)</strong></p>
<p>These fields summarize <strong>extreme high-temperature events</strong>, using thresholds of <strong>35°C</strong>, <strong>37.5°C</strong>, and <strong>40°C</strong>. The same set of metrics is calculated for each threshold:</p>
<ul>
<li><strong><code>tmax_tg_[threshold].days</code></strong>: Total number of days where maximum temperature (<code>Tmax</code>) exceeded the threshold. e.g., <code>tmax_tg_35.days</code> = number of days &gt; 35°C.<br>
</li>
<li><strong><code>tmax_tg_[threshold].days_pr</code></strong>: Proportion of days in the season above the threshold.<br>
</li>
<li><strong><code>tmax_tg_[threshold].max_rseq</code></strong>: Maximum length of any <strong>consecutive sequence</strong> of days above the threshold.<br>
</li>
<li><strong><code>tmax_tg_[threshold].n_seq_dX</code></strong>: Number of <strong>sequences of at least X days</strong> where Tmax stayed above the threshold.
<ul>
<li><code>d5</code>: ≥5 consecutive days.</li>
<li><code>d10</code>: ≥10 consecutive days<br>
</li>
<li><code>d15</code>: ≥15 consecutive days</li>
</ul></li>
</ul>
<p>These indicators help assess the <strong>intensity, persistence, and frequency</strong> of heat stress.</p>
<p><strong>2. General Temperature Statistics</strong></p>
<p>These capture broader temperature behavior during the season:</p>
<ul>
<li><strong>Tmin-related fields:</strong>
<ul>
<li><code>tmin_min</code>: Minimum of daily minimum temperatures</li>
<li><code>tmin_mean</code>: Mean daily minimum temperature</li>
<li><code>tmin_var</code>: Variance of daily minimum temperatures</li>
<li><code>tmin_sd</code>: Standard deviation of daily minimum temperatures</li>
<li><code>tmin_range</code>: Difference between max and min daily minimum temperatures</li>
</ul></li>
<li><strong>Tmax-related fields:</strong>
<ul>
<li><code>tmax_max</code>: Maximum of daily maximum temperatures</li>
<li><code>tmax_mean</code>: Mean daily maximum temperature</li>
<li><code>tmax_var</code>: Variance of daily maximum temperatures</li>
<li><code>tmax_sd</code>: Standard deviation of daily maximum temperatures</li>
<li><code>tmax_range</code>: Difference between max and min daily maximum temperatures</li>
</ul></li>
<li><strong>Tmean (daily average temperature) fields:</strong>
<ul>
<li><code>tmean_max</code>: Maximum of daily mean temperatures</li>
<li><code>tmean_min</code>: Minimum of daily mean temperatures</li>
<li><code>tmean_mean</code>: Mean of daily mean temperatures</li>
<li><code>tmean_var</code>: Variance of daily mean temperatures</li>
<li><code>tmean_sd</code>: Standard deviation of daily mean temperatures</li>
<li><code>tmean_range</code>: Difference between max and min daily mean temperatures</li>
</ul></li>
</ul>
<p>These metrics provide a comprehensive description of <strong>temperature variability and extremes</strong> during the growing season.</p>
</section>
<section id="rainfall" class="level4" data-number="1.6.2.4">
<h4 data-number="1.6.2.4" class="anchored" data-anchor-id="rainfall"><span class="header-section-number">1.6.2.4</span> rainfall</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clim_data<span class="sc">$</span>PDate.SLen.Data<span class="sc">$</span>temperature) <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.max_rseq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_35.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.max_rseq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_37.5.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.max_rseq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_tg_40.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmin_min</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmin_mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmin_var</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmin_sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmin_range</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_max</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_var</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmax_range</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_max</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_min</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_var</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">tmean_range</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">row_index</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">M.Year</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">EU</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Product</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">window</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">15.50</td>
<td style="text-align: right;">18.476809</td>
<td style="text-align: right;">0.8375705</td>
<td style="text-align: right;">0.9151888</td>
<td style="text-align: right;">5.09</td>
<td style="text-align: right;">30.58</td>
<td style="text-align: right;">26.18730</td>
<td style="text-align: right;">2.720730</td>
<td style="text-align: right;">1.649463</td>
<td style="text-align: right;">8.60</td>
<td style="text-align: right;">24.69</td>
<td style="text-align: right;">19.63</td>
<td style="text-align: right;">22.00830</td>
<td style="text-align: right;">0.9936999</td>
<td style="text-align: right;">0.9968450</td>
<td style="text-align: right;">5.06</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">15.39</td>
<td style="text-align: right;">17.872208</td>
<td style="text-align: right;">0.8065650</td>
<td style="text-align: right;">0.8980897</td>
<td style="text-align: right;">5.74</td>
<td style="text-align: right;">32.20</td>
<td style="text-align: right;">26.27351</td>
<td style="text-align: right;">6.365606</td>
<td style="text-align: right;">2.523015</td>
<td style="text-align: right;">10.89</td>
<td style="text-align: right;">25.41</td>
<td style="text-align: right;">19.00</td>
<td style="text-align: right;">21.75870</td>
<td style="text-align: right;">1.8366676</td>
<td style="text-align: right;">1.3552371</td>
<td style="text-align: right;">6.41</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1987</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">9.10</td>
<td style="text-align: right;">11.624133</td>
<td style="text-align: right;">1.4849358</td>
<td style="text-align: right;">1.2185794</td>
<td style="text-align: right;">5.24</td>
<td style="text-align: right;">29.41</td>
<td style="text-align: right;">25.09500</td>
<td style="text-align: right;">3.614292</td>
<td style="text-align: right;">1.901129</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">19.75</td>
<td style="text-align: right;">15.91</td>
<td style="text-align: right;">17.69460</td>
<td style="text-align: right;">0.7627982</td>
<td style="text-align: right;">0.8733832</td>
<td style="text-align: right;">3.84</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">2001.2</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2001-10-01</td>
<td style="text-align: left;">2001-10-30</td>
<td style="text-align: left;">2002-02-01</td>
<td style="text-align: left;">2002-02-28</td>
<td style="text-align: left;">-0.0833 37.0000 B917</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">9.29</td>
<td style="text-align: right;">11.624065</td>
<td style="text-align: right;">1.7777506</td>
<td style="text-align: right;">1.3333231</td>
<td style="text-align: right;">6.09</td>
<td style="text-align: right;">26.77</td>
<td style="text-align: right;">24.29724</td>
<td style="text-align: right;">1.467853</td>
<td style="text-align: right;">1.211550</td>
<td style="text-align: right;">6.54</td>
<td style="text-align: right;">18.63</td>
<td style="text-align: right;">15.65</td>
<td style="text-align: right;">17.36220</td>
<td style="text-align: right;">0.4043255</td>
<td style="text-align: right;">0.6358659</td>
<td style="text-align: right;">2.98</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">2002.1</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2002-04-01</td>
<td style="text-align: left;">2002-04-30</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">-0.0833 37.0000 B917</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.19</td>
<td style="text-align: right;">9.939118</td>
<td style="text-align: right;">1.5819044</td>
<td style="text-align: right;">1.2577378</td>
<td style="text-align: right;">5.36</td>
<td style="text-align: right;">25.11</td>
<td style="text-align: right;">21.47147</td>
<td style="text-align: right;">2.016235</td>
<td style="text-align: right;">1.419942</td>
<td style="text-align: right;">6.76</td>
<td style="text-align: right;">17.57</td>
<td style="text-align: right;">13.45</td>
<td style="text-align: right;">15.46684</td>
<td style="text-align: right;">0.6721388</td>
<td style="text-align: right;">0.8198407</td>
<td style="text-align: right;">4.12</td>
<td style="text-align: right;">60</td>
<td style="text-align: left;">2004</td>
<td style="text-align: left;">c14</td>
<td style="text-align: left;">Wheat</td>
<td style="text-align: left;">2004-05-25</td>
<td style="text-align: left;">2004-05-25</td>
<td style="text-align: left;">2004-10-07</td>
<td style="text-align: left;">2004-10-07</td>
<td style="text-align: left;">-0.3780 35.9890 B500</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.37</td>
<td style="text-align: right;">10.546338</td>
<td style="text-align: right;">1.6467624</td>
<td style="text-align: right;">1.2832624</td>
<td style="text-align: right;">6.58</td>
<td style="text-align: right;">25.80</td>
<td style="text-align: right;">21.42162</td>
<td style="text-align: right;">2.694102</td>
<td style="text-align: right;">1.641372</td>
<td style="text-align: right;">8.99</td>
<td style="text-align: right;">17.54</td>
<td style="text-align: right;">13.63</td>
<td style="text-align: right;">15.64239</td>
<td style="text-align: right;">0.6342666</td>
<td style="text-align: right;">0.7964085</td>
<td style="text-align: right;">3.91</td>
<td style="text-align: right;">61</td>
<td style="text-align: left;">2005</td>
<td style="text-align: left;">c14</td>
<td style="text-align: left;">Wheat</td>
<td style="text-align: left;">2005-05-14</td>
<td style="text-align: left;">2005-05-14</td>
<td style="text-align: left;">2005-10-02</td>
<td style="text-align: left;">2005-10-02</td>
<td style="text-align: left;">-0.3780 35.9890 B500</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>This table summarizes rainfall-related climate statistics.</p>
<p><strong>1. Total and Derived Rainfall Metrics</strong> - <code>rain_sum</code>: Total rainfall (mm) accumulated over the observation window.<br>
- <code>eto_sum</code>: Total reference evapotranspiration (mm) over the window, calculated from NASA POWER data.<br>
- <code>eto_na</code>: Number of days with missing <code>ETO</code> values due to data unavailability.<br>
- <code>w_balance</code>: Approximate seasonal water balance: <code>rain_sum</code> – <code>eto_sum</code>.<br>
- <code>w_balance_negdays</code>: Number of days when daily rainfall &lt; daily evapotranspiration (i.e., water deficit days).</p>
<p><strong>2. Dry Spell Indicators (<code>rain_l_*</code>)</strong></p>
<p>These indicators summarize <strong>dry spells</strong> using thresholds of <strong>0.1 mm</strong>, <strong>1 mm</strong>, and <strong>5 mm</strong> of daily rainfall.</p>
<p>For each threshold:<br>
- <strong><code>rain_l_[threshold].days</code></strong>: Total number of days below the rainfall threshold. e.g., <code>rain_l_1.days</code> = number of days with rainfall &lt; 1 mm.<br>
- <code>rain_l_[threshold].days_pr</code> Proportion of total days below the threshold.<br>
- <code>rain_l_[threshold].max_seq</code>: Length of the <strong>longest consecutive sequence</strong> of dry days.<br>
- <code>rain_l_[threshold].n_seq_dX</code>:Number of dry spells lasting at least X days:<br>
- <code>d5</code> = ≥5 consecutive days<br>
- <code>d10</code> = ≥10 consecutive days<br>
- <code>d15</code> = ≥15 consecutive days</p>
<p>Thresholds used: - <code>rain_l_0.1</code>: Very light rainfall (effectively dry)<br>
- <code>rain_l_1</code>: Light rainfall<br>
- <code>rain_l_5</code>: Moderate rainfall threshold</p>
<p>These variables help identify <strong>drought risk</strong>, <strong>intra-seasonal dry periods</strong>, and <strong>rainfall distribution</strong> relevant to crop growth.</p>
</section>
<section id="eratio" class="level4" data-number="1.6.2.5">
<h4 data-number="1.6.2.5" class="anchored" data-anchor-id="eratio"><span class="header-section-number">1.6.2.5</span> eratio</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clim_data<span class="sc">$</span>PDate.SLen.Data<span class="sc">$</span>eratio) <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_median</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_min</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.5.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.5.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.5.max_seq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.5.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.5.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.5.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.25.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.25.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.25.max_seq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.25.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.25.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.25.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.1.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.1.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.1.max_seq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.1.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.1.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">eratio_l_0.1.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">row_index</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">M.Year</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">EU</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Product</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">window</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.8575887</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.7500000</td>
<td style="text-align: right;">0.900</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1987</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.2732000</td>
<td style="text-align: right;">0.100</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">116</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">2001.2</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2001-10-01</td>
<td style="text-align: left;">2001-10-30</td>
<td style="text-align: left;">2002-02-01</td>
<td style="text-align: left;">2002-02-28</td>
<td style="text-align: left;">-0.0833 37.0000 B917</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.2997561</td>
<td style="text-align: right;">0.150</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">2002.1</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2002-04-01</td>
<td style="text-align: left;">2002-04-30</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">-0.0833 37.0000 B917</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.2817647</td>
<td style="text-align: right;">0.205</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">60</td>
<td style="text-align: left;">2004</td>
<td style="text-align: left;">c14</td>
<td style="text-align: left;">Wheat</td>
<td style="text-align: left;">2004-05-25</td>
<td style="text-align: left;">2004-05-25</td>
<td style="text-align: left;">2004-10-07</td>
<td style="text-align: left;">2004-10-07</td>
<td style="text-align: left;">-0.3780 35.9890 B500</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.5081690</td>
<td style="text-align: right;">0.445</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">61</td>
<td style="text-align: left;">2005</td>
<td style="text-align: left;">c14</td>
<td style="text-align: left;">Wheat</td>
<td style="text-align: left;">2005-05-14</td>
<td style="text-align: left;">2005-05-14</td>
<td style="text-align: left;">2005-10-02</td>
<td style="text-align: left;">2005-10-02</td>
<td style="text-align: left;">-0.3780 35.9890 B500</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>These variables describe <strong>evaporative ratio (Eratio)</strong> statistics, which serve as a proxy for water stress during the crop season.<br>
<strong>Eratio</strong> is computed as the ratio of <strong>actual evapotranspiration (Ea)</strong> to <strong>potential evapotranspiration (Ep)</strong>, based on a daily water balance simulation that accounts for rainfall, PET, and soil water-holding capacity:</p>
<p><code>Eratio = Ea / Ep</code></p>
<ul>
<li><strong>Ep</strong> (potential evapotranspiration) is calculated using the <strong>Priestley–Taylor method</strong>.</li>
<li><strong>Ea</strong> is estimated by simulating <strong>daily water availability</strong> in the soil, using a simple empirical model based on soil capacity and depletion (see <code>calc_daily_watbal()</code> in <code>watbal_all_in_one.R</code>).</li>
<li>Soil properties (e.g., field capacity, saturation, depth) are estimated using a pedotransfer function (<code>AWCPTF()</code>), and aggregated with <code>soilcap_calc()</code>.</li>
</ul>
<p>This approach integrates soil, rainfall, and climate to better reflect actual water supply to crops, beyond rainfall alone.</p>
<p>Low values indicate water deficits, while higher values suggest sufficient water supply relative to atmospheric demand.</p>
<p><strong>1. Summary Eratio Statistics</strong></p>
<ul>
<li><code>eratio_mean</code>: Mean daily Eratio over the observation window.<br>
</li>
<li><code>eratio_median</code>: Median daily Eratio.<br>
</li>
<li><code>eratio_min</code>: Minimum daily Eratio (most severe water deficit day).</li>
</ul>
<p><strong>2. Water Stress Indicators (<code>eratio_l_*</code>)</strong></p>
<p>These fields capture <strong>frequency, duration, and intensity of low Eratio events</strong>, using thresholds of <strong>&lt;0.5</strong>, <strong>&lt;0.25</strong>, and <strong>&lt;0.1</strong>.</p>
<p>For each threshold: - <code>eratio_l_[threshold].days</code>: Number of days where Eratio fell below the threshold. e.g., <code>eratio_l_0.5.days</code> = number of days with Eratio &lt; 0.5.<br>
- <code>eratio_l_[threshold].days_pr</code>: Proportion of total days with Eratio below the threshold.<br>
- <code>eratio_l_[threshold].max_seq</code>: Maximum <strong>consecutive sequence</strong> of days below the threshold.<br>
- <code>eratio_l_[threshold].n_seq_dX</code>: Number of <strong>spells of at least X consecutive days</strong> below the threshold:<br>
- <code>d5</code> = ≥5 consecutive days<br>
- <code>d10</code> = ≥10 consecutive days<br>
- <code>d15</code> = ≥15 consecutive days</p>
<p>Thresholds represent escalating levels of water stress: - <code>0.5</code>: Mild deficit<br>
- <code>0.25</code>: Moderate deficit<br>
- <code>0.1</code>: Severe deficit</p>
<p>These metrics can be used to <strong>identify seasonal water stress risk</strong>, <strong>evaluate drought periods</strong>, and <strong>inform adaptive irrigation or planting strategies</strong>.</p>
</section>
<section id="logging" class="level4" data-number="1.6.2.6">
<h4 data-number="1.6.2.6" class="anchored" data-anchor-id="logging"><span class="header-section-number">1.6.2.6</span> logging</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clim_data<span class="sc">$</span>PDate.SLen.Data<span class="sc">$</span>logging) <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_sum</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_median</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_present_mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_0.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_0.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_0.max_seq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_0.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_0.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_0.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.5.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.5.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.5.max_seq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.5.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.5.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.5.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.9.days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.9.days_pr</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.9.max_seq</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.9.n_seq_d5</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.9.n_seq_d10</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">logging_g_ssat_0.9.n_seq_d15</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">row_index</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">M.Year</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">EU</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Product</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">window</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">7.80</td>
<td style="text-align: right;">0.0553191</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-03-22</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">2010-08-09</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.80</td>
<td style="text-align: right;">0.0116883</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1987</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-03-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">1987-08-13</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">0.0210000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">2001.2</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2001-10-01</td>
<td style="text-align: left;">2001-10-30</td>
<td style="text-align: left;">2002-02-01</td>
<td style="text-align: left;">2002-02-28</td>
<td style="text-align: left;">-0.0833 37.0000 B917</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.70</td>
<td style="text-align: right;">0.0219512</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">106</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">106</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">2002.1</td>
<td style="text-align: left;">c7</td>
<td style="text-align: left;">Maize</td>
<td style="text-align: left;">2002-04-01</td>
<td style="text-align: left;">2002-04-30</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">-0.0833 37.0000 B917</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">60</td>
<td style="text-align: left;">2004</td>
<td style="text-align: left;">c14</td>
<td style="text-align: left;">Wheat</td>
<td style="text-align: left;">2004-05-25</td>
<td style="text-align: left;">2004-05-25</td>
<td style="text-align: left;">2004-10-07</td>
<td style="text-align: left;">2004-10-07</td>
<td style="text-align: left;">-0.3780 35.9890 B500</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">61</td>
<td style="text-align: left;">2005</td>
<td style="text-align: left;">c14</td>
<td style="text-align: left;">Wheat</td>
<td style="text-align: left;">2005-05-14</td>
<td style="text-align: left;">2005-05-14</td>
<td style="text-align: left;">2005-10-02</td>
<td style="text-align: left;">2005-10-02</td>
<td style="text-align: left;">-0.3780 35.9890 B500</td>
<td style="text-align: left;">PlantingDate-SeasonLength.Data</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>These variables summarize <strong>soil waterlogging</strong> conditions during the crop season.<br>
Waterlogging is defined here as the <strong>amount of water held in the soil above field capacity</strong> but <strong>below saturation</strong>, simulated via a daily water balance using <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/functions/water_balance.R"><code>calc_daily_watbal()</code></a> from <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/functions/water_balance.R"><code>watbal_all_in_one.R</code></a>.</p>
<p>Logging occurs when incoming rainfall exceeds the soil’s capacity to retain water at field capacity, but has <strong>not yet exceeded total saturation</strong>.</p>
<p><strong>1. Summary Waterlogging Statistics</strong></p>
<ul>
<li><code>logging_sum</code>: Total cumulative logging value across the observation window.<br>
</li>
<li><code>logging_mean</code>: Mean daily logging value.<br>
</li>
<li><code>logging_median</code>: Median daily logging value.<br>
</li>
<li><code>logging_present_mean</code>: Mean logging value on days when waterlogging was present (i.e., &gt; 0).</li>
</ul>
<p><strong>2. General Waterlogging Presence (<code>logging_g_0.*</code>)</strong></p>
<p>These fields indicate periods when <strong>water balance &gt; 0</strong>, a proxy for general waterlogging.</p>
<ul>
<li><code>logging_g_0.days</code>: Number of days where waterlogging &gt; 0.<br>
</li>
<li><code>logging_g_0.days_pr</code>: Proportion of days with waterlogging &gt; 0.<br>
</li>
<li><code>logging_g_0.max_seq</code>: Longest <strong>consecutive sequence</strong> of waterlogged days.<br>
</li>
<li><code>logging_g_0.n_seq_dX</code>: Number of <strong>spells</strong> of X consecutive days with waterlogging:
<ul>
<li><code>d5</code>: ≥5 consecutive days</li>
<li><code>d10</code>: ≥10 consecutive days</li>
<li><code>d15</code>: ≥15 consecutive days</li>
</ul></li>
</ul>
<p><strong>3. Saturation Threshold Indicators (<code>logging_g_ssat_*</code>)</strong></p>
<p>These fields apply stricter thresholds based on <strong>soil saturation</strong>: - <code>ssat_0.5</code>: Moderate saturation (50% of saturation) - <code>ssat_0.9</code>: High saturation (90% of saturation)</p>
<p>For each threshold:</p>
<ul>
<li><code>logging_g_ssat_[threshold].days</code>: Number of days exceeding the saturation threshold.<br>
</li>
<li><code>logging_g_ssat_[threshold].days_pr</code>: Proportion of season with saturation exceeded.<br>
</li>
<li><code>logging_g_ssat_[threshold].max_seq</code>: Maximum consecutive days above threshold.</li>
<li><code>logging_g_ssat_[threshold].n_seq_dX</code>: Number of <strong>long saturation spells</strong>:
<ul>
<li><code>d5</code>: ≥5 consecutive days<br>
</li>
<li><code>d10</code>: ≥10 consecutive days<br>
</li>
<li><code>d15</code>: ≥15 consecutive days</li>
</ul></li>
</ul>
<p>These indicators help assess <strong>excess moisture risks</strong>, which can influence <strong>root health</strong>, <strong>germination success</strong>, and <strong>yields</strong>.</p>
</section>
</section>
</section>
<section id="connecting-climate-stats-back-to-the-era-database" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="connecting-climate-stats-back-to-the-era-database"><span class="header-section-number">1.7</span> Connecting climate stats back to the ERA database</h2>
<section id="era-comparisons-table" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="era-comparisons-table"><span class="header-section-number">1.7.1</span> ERA Comparisons Table</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the remote S3 path and local save path</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>s3_data_dir <span class="ot">&lt;-</span> <span class="st">"s3://digital-atlas/era/data"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>local_data_dir <span class="ot">&lt;-</span> <span class="st">"downloaded_data"</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># List and filter files</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>s3<span class="ot">&lt;-</span>s3fs<span class="sc">::</span>S3FileSystem<span class="sc">$</span><span class="fu">new</span>(<span class="at">anonymous =</span> T)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"compiled.*mh.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to most recent version of dataset</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>(files_s3 <span class="ot">&lt;-</span> <span class="fu">tail</span>(files_s3, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/data/era_compiled_ls-v1.0-mh_2025-03-19.2-sc_2025_01_30.1-ie_2025_05_09.2-2025-05-09.1.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create local file path and download</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, files_s3)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local)){</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  s3<span class="sc">$</span><span class="fu">file_download</span>(files_s3, files_local)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>era_comparisons<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>key_fields<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Site.Key"</span>,<span class="st">"M.Year"</span>,<span class="st">"Product.Simple"</span>,<span class="st">"Plant.Start"</span>,<span class="st">"Plant.End"</span>,<span class="st">"Harvest.Start"</span>,<span class="st">"Harvest.End"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Climate data to merge</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>clim_mergedat<span class="ot">&lt;-</span>clim_data<span class="sc">$</span>PDate.SLen.EcoCrop<span class="sc">$</span>gdd</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the Product field to match the ERA comparisons table</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(clim_mergedat,<span class="st">"Product"</span>,<span class="st">"Product.Simple"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unneeded columns </span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>clim_mergedat[,<span class="fu">c</span>(<span class="st">"row_index"</span>,<span class="st">"window"</span>,<span class="st">"EU"</span>)<span class="sc">:</span><span class="er">=</span><span class="cn">NULL</span>]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any duplicates</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>clim_mergedat<span class="ot">&lt;-</span><span class="fu">unique</span>(clim_mergedat)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge datasets</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>era_comparisons_gdd<span class="ot">&lt;-</span><span class="fu">merge</span>(era_comparisons,clim_mergedat,<span class="at">by=</span>key_fields,<span class="at">all.x=</span>T,<span class="at">sort=</span>F)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore merge result</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(era_comparisons_gdd[<span class="sc">!</span><span class="fu">is.na</span>(gdd_subopt),<span class="fu">c</span>(key_fields,<span class="fu">grep</span>(<span class="st">"gdd"</span>,<span class="fu">colnames</span>(era_comparisons_gdd),<span class="at">value=</span>T)),<span class="at">with=</span>F])<span class="sc">|&gt;</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">M.Year</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Product.Simple</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Plant.End</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.Start</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Harvest.End</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">gdd_subopt</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">gdd_opt</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">gdd_aboveopt</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">gdd_abovemax</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>

</tbody>
</table>
</div>

</div>
</div>
<p>How many observations have we enriched?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>era_comparisons_gdd[<span class="sc">!</span><span class="fu">is.na</span>(gdd_subopt),.N]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>era_comparisons_gdd[<span class="sc">!</span><span class="fu">is.na</span>(gdd_subopt),.N]<span class="sc">/</span>era_comparisons_gdd[,.N]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Why is this less than half of the total data available? - 1. A planting date or window must have been reported. - 2. If planting uncertainty is too high, it may not have been possible to infer the planting date. - 3. Sites with large spatial uncertainty (&gt;50km radius) are excluded. - 4. Climate statistics have not been calculated for animal experiments. - 5. Climate statistics are not calculated for spatially aggregated sites, products or time periods.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>era_comparisons_gdd[<span class="sc">!</span><span class="fu">is.na</span>(gdd_subopt),.N]<span class="sc">/</span>era_comparisons_gdd[<span class="sc">!</span><span class="fu">is.na</span>(Plant.Start) <span class="sc">&amp;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                                                                 Buffer<span class="sc">&lt;</span><span class="dv">50000</span> <span class="sc">&amp;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                                                                 <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[.][.]"</span>,Site.ID) <span class="sc">&amp;</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                                                                 <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[.][.]"</span>,M.Year) <span class="sc">&amp;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                                                                 <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"-"</span>,Product.Simple),.N]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Non-matches, if present, indicate missing data in the era climate stats pipeline, please let us know and check for updates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>era_comparisons_gdd[<span class="sc">!</span><span class="fu">is.na</span>(Plant.Start) <span class="sc">&amp;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                         Buffer<span class="sc">&lt;</span><span class="dv">50000</span> <span class="sc">&amp;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[.][.]"</span>,Site.ID) <span class="sc">&amp;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[.][.]"</span>,M.Year) <span class="sc">&amp;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"-"</span>,Product.Simple) <span class="sc">&amp;</span> <span class="fu">is.na</span>(gdd_subopt),key_fields,with<span class="ot">=</span>F]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Site.Key M.Year Product.Simple Plant.Start  Plant.End
                  &lt;char&gt; &lt;char&gt;         &lt;char&gt;      &lt;Date&gt;     &lt;Date&gt;
 1: 05.4810 07.5370 B300   2001     Crustacean  1985-08-21 1985-08-31
 2: 05.4810 07.5370 B300   2002     Crustacean  1986-08-21 1986-08-31
 3: 05.4810 07.5370 B300   2001     Crustacean  1986-08-21 1986-08-31
 4: 05.4810 07.5370 B300   2001     Crustacean  1987-08-21 1987-08-31
 5: 05.4810 07.5370 B300   2002     Crustacean  1986-08-21 1986-08-31
 6: 05.4810 07.5370 B300   2002     Crustacean  1987-08-21 1987-08-31
 7: 05.4810 07.5370 B300   2001     Crustacean  1987-08-21 1987-08-31
 8: 05.4810 07.5370 B300   2001     Crustacean  1987-08-21 1987-08-31
 9: 05.4810 07.5370 B300   2002     Crustacean  1986-08-21 1986-08-31
10: 05.4810 07.5370 B300   2002     Crustacean  1987-08-21 1987-08-31
    Harvest.Start Harvest.End
           &lt;Date&gt;      &lt;Date&gt;
 1:    1985-10-21  1985-10-30
 2:    1986-10-21  1986-10-30
 3:    1986-10-21  1986-10-30
 4:    1987-10-21  1987-10-30
 5:    1986-10-21  1986-10-30
 6:    1987-10-21  1987-10-30
 7:    1987-10-21  1987-10-30
 8:    1987-10-21  1987-10-30
 9:    1986-10-21  1986-10-30
10:    1987-10-21  1987-10-30</code></pre>
</div>
</div>
</section>
</section>
<section id="foundational-datasets" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="foundational-datasets"><span class="header-section-number">1.8</span> Foundational datasets</h2>
<section id="rainfall-1" class="level3" data-number="1.8.1">
<h3 data-number="1.8.1" class="anchored" data-anchor-id="rainfall-1"><span class="header-section-number">1.8.1</span> Rainfall</h3>
<p>Rainfall data are downloaded using <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/functions/download_chirps.R"><code>R/add_geodata/functions/download_chirps.R</code></a> and processed using the script <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/chirps.R"><code>R/add_geodata/chirps.R</code></a>.</p>
<section id="access" class="level4" data-number="1.8.1.1">
<h4 data-number="1.8.1.1" class="anchored" data-anchor-id="access"><span class="header-section-number">1.8.1.1</span> Access</h4>
<p>The annual and long-term average datasets are small, we can simply download them from the ERA s3 bucket.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the remote S3 path and local save path</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>s3_data_dir <span class="ot">&lt;-</span> <span class="st">"s3://digital-atlas/era/geodata"</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># List and filter files</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>s3<span class="ot">&lt;-</span>s3fs<span class="sc">::</span>S3FileSystem<span class="sc">$</span><span class="fu">new</span>(<span class="at">anonymous =</span> T)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>file_ltavg<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"chirps_ltavg.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>file_annnual<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"chirps_annual.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to most recent version of dataset</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>(file_ltavg <span class="ot">&lt;-</span> <span class="fu">tail</span>(file_ltavg, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/chirps_ltavg_2025-04-12.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(file_annnual <span class="ot">&lt;-</span> <span class="fu">tail</span>(file_annnual, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/chirps_annual_2025-04-12.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>files_s3<span class="ot">&lt;-</span><span class="fu">c</span>(file_ltavg,file_annnual)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create local file path and download</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, files_s3)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(files_local)){</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local[i])){</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    s3<span class="sc">$</span><span class="fu">file_download</span>(files_s3[i], files_local[i])</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Load ltavg and annual data</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>chirps_ltavg<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local[<span class="dv">1</span>])</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>chirps_annual<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The daily CHIRPS dataset id quite large, let’s use the arrow package to download the head of the data only. To learn more about using the arrow package to access parquet data in R see <a href="https://arrow.apache.org/docs/r/" class="uri">https://arrow.apache.org/docs/r/</a>.<br>
In future ERA updates we will optimize the partition structure of parquet tables to faciliate faster access, in the short-term we suggest working locally with files is still the best option.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load head of daily data only</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>file_daily<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"chirps.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>file_daily<span class="ot">&lt;-</span>file_daily[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"ltavg|annual"</span>,file_daily)]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>(file_daily <span class="ot">&lt;-</span> <span class="fu">tail</span>(file_daily, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/chirps_2025-04-12.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, file_daily)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local)){</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  chirps_daily<span class="ot">&lt;-</span><span class="fu">open_dataset</span>(file_daily, <span class="at">format =</span> <span class="st">"parquet"</span>, <span class="at">filesystem =</span> s3)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the first 5 rows into a data.table</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  chirps_daily <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(<span class="fu">head</span>(chirps_daily, <span class="dv">5</span>))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save result</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  arrow<span class="sc">::</span><span class="fu">write_parquet</span>(chirps_daily,files_local)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  chirps_daily<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="structure" class="level4" data-number="1.8.1.2">
<h4 data-number="1.8.1.2" class="anchored" data-anchor-id="structure"><span class="header-section-number">1.8.1.2</span> Structure</h4>
<p><strong>Daily precipitation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chirps_daily) <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">date</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Rain</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">day_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1981-01-01</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">29585</td>
</tr>
<tr class="even">
<td style="text-align: left;">1981-01-02</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">29586</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1981-01-03</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">29587</td>
</tr>
<tr class="even">
<td style="text-align: left;">1981-01-04</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">29588</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1981-01-05</td>
<td style="text-align: right;">22.81</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">29589</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>Annual precipitation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chirps_annual) <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Year</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total.Rain</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">1981</td>
<td style="text-align: right;">1585.75</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0108 36.9617 B250</td>
<td style="text-align: left;">1981</td>
<td style="text-align: right;">836.60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0333 34.8000 B917</td>
<td style="text-align: left;">1981</td>
<td style="text-align: right;">1577.04</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0333 37.8333 B917</td>
<td style="text-align: left;">1981</td>
<td style="text-align: right;">1424.46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0420 34.5920 B12500</td>
<td style="text-align: left;">1981</td>
<td style="text-align: right;">1467.24</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0620 34.2290 B30000</td>
<td style="text-align: left;">1981</td>
<td style="text-align: right;">1232.72</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>Long-term average precipitation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chirps_ltavg) <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total.Rain.mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total.Rain.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total.Rain</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1794.8684</td>
<td style="text-align: right;">281.26</td>
<td style="text-align: right;">1794.87</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0108 36.9617 B250</td>
<td style="text-align: right;">758.7884</td>
<td style="text-align: right;">153.56</td>
<td style="text-align: right;">758.79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0333 34.8000 B917</td>
<td style="text-align: right;">1707.8786</td>
<td style="text-align: right;">273.12</td>
<td style="text-align: right;">1707.88</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0333 37.8333 B917</td>
<td style="text-align: right;">1249.3691</td>
<td style="text-align: right;">311.05</td>
<td style="text-align: right;">1249.37</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0420 34.5920 B12500</td>
<td style="text-align: right;">1677.6044</td>
<td style="text-align: right;">261.69</td>
<td style="text-align: right;">1677.60</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0620 34.2290 B30000</td>
<td style="text-align: right;">1377.4658</td>
<td style="text-align: right;">218.68</td>
<td style="text-align: right;">1377.47</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</section>
</section>
<section id="power" class="level3" data-number="1.8.2">
<h3 data-number="1.8.2" class="anchored" data-anchor-id="power"><span class="header-section-number">1.8.2</span> POWER</h3>
<p>POWER data are downloaded using <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/functions/download_power.R"><code>R/add_geodata/functions/download_power.R</code></a> and processed using the script <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/power.R"><code>R/add_geodata/power.R</code></a>.</p>
<section id="access-1" class="level4" data-number="1.8.2.1">
<h4 data-number="1.8.2.1" class="anchored" data-anchor-id="access-1"><span class="header-section-number">1.8.2.1</span> Access</h4>
<p>The annual and long-term average datasets are small, we can simply download them from the ERA s3 bucket.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the remote S3 path and local save path</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>s3_data_dir <span class="ot">&lt;-</span> <span class="st">"s3://digital-atlas/era/geodata"</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># List and filter files</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>s3<span class="ot">&lt;-</span>s3fs<span class="sc">::</span>S3FileSystem<span class="sc">$</span><span class="fu">new</span>(<span class="at">anonymous =</span> T)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>file_ltavg<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"POWER_ltavg.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>file_annnual<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"POWER_annual.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to most recent version of dataset</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>(file_ltavg <span class="ot">&lt;-</span> <span class="fu">tail</span>(file_ltavg, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/POWER_ltavg_2025-04-12.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>(file_annnual <span class="ot">&lt;-</span> <span class="fu">tail</span>(file_annnual, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/POWER_annual_2025-04-12.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>files_s3<span class="ot">&lt;-</span><span class="fu">c</span>(file_ltavg,file_annnual)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create local file path and download</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, files_s3)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(files_local)){</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local[i])){</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    s3<span class="sc">$</span><span class="fu">file_download</span>(files_s3[i], files_local[i])</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Load ltavg and annual data</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>power_ltavg<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local[<span class="dv">1</span>])</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>power_annual<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>file_daily<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"POWER.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>file_daily<span class="ot">&lt;-</span>file_daily[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"ltavg|annual"</span>,file_daily)]</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>(file_daily <span class="ot">&lt;-</span> <span class="fu">tail</span>(file_daily, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/POWER_2025-04-12.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, file_daily)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local)){</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    s3<span class="sc">$</span><span class="fu">file_download</span>(file_daily, files_local)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset to the first 5 rows</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  power_daily <span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save result</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  arrow<span class="sc">::</span><span class="fu">write_parquet</span>(power_daily,files_local)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  power_daily<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="structure-1" class="level4" data-number="1.8.2.2">
<h4 data-number="1.8.2.2" class="anchored" data-anchor-id="structure-1"><span class="header-section-number">1.8.2.2</span> Structure</h4>
<p><strong>Daily power</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(power_daily) <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Year</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Day</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Pressure.Corrected</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">WindSpeed</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Specific.Humid</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Min</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Humid</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Max</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Pressure</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">SRad</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Rain</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Latitude</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Longitude</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Altitude</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">ETo</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Date</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">DayCount</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">84.72</td>
<td style="text-align: right;">1.52</td>
<td style="text-align: right;">12.16</td>
<td style="text-align: right;">16.06</td>
<td style="text-align: right;">64.75</td>
<td style="text-align: right;">28.67</td>
<td style="text-align: right;">22.50</td>
<td style="text-align: right;">87.10</td>
<td style="text-align: right;">22.02</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">1515.043</td>
<td style="text-align: right;">4.54</td>
<td style="text-align: left;">1984-01-01</td>
<td style="text-align: right;">30680</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">84.76</td>
<td style="text-align: right;">1.67</td>
<td style="text-align: right;">12.34</td>
<td style="text-align: right;">16.98</td>
<td style="text-align: right;">63.54</td>
<td style="text-align: right;">28.30</td>
<td style="text-align: right;">22.82</td>
<td style="text-align: right;">87.14</td>
<td style="text-align: right;">21.16</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">1515.043</td>
<td style="text-align: right;">4.51</td>
<td style="text-align: left;">1984-01-02</td>
<td style="text-align: right;">30681</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">84.80</td>
<td style="text-align: right;">2.42</td>
<td style="text-align: right;">12.43</td>
<td style="text-align: right;">17.08</td>
<td style="text-align: right;">67.59</td>
<td style="text-align: right;">28.18</td>
<td style="text-align: right;">22.01</td>
<td style="text-align: right;">87.17</td>
<td style="text-align: right;">21.43</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">1515.043</td>
<td style="text-align: right;">4.66</td>
<td style="text-align: left;">1984-01-03</td>
<td style="text-align: right;">30682</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">84.78</td>
<td style="text-align: right;">1.63</td>
<td style="text-align: right;">12.18</td>
<td style="text-align: right;">15.99</td>
<td style="text-align: right;">66.83</td>
<td style="text-align: right;">28.29</td>
<td style="text-align: right;">21.84</td>
<td style="text-align: right;">87.15</td>
<td style="text-align: right;">22.30</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">1515.043</td>
<td style="text-align: right;">4.54</td>
<td style="text-align: left;">1984-01-04</td>
<td style="text-align: right;">30683</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">84.62</td>
<td style="text-align: right;">2.08</td>
<td style="text-align: right;">10.42</td>
<td style="text-align: right;">15.68</td>
<td style="text-align: right;">57.07</td>
<td style="text-align: right;">28.73</td>
<td style="text-align: right;">21.98</td>
<td style="text-align: right;">87.00</td>
<td style="text-align: right;">24.13</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">1515.043</td>
<td style="text-align: right;">5.20</td>
<td style="text-align: left;">1984-01-05</td>
<td style="text-align: right;">30684</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>Annual power</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(power_annual) <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Year</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total.Rain</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total.ETo</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">S.Humid.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Humid.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Mean.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Mean.N.30.Days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Mean.N.35.Days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Max.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Max</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Max.N.40.Days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Min.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Min</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">1662</td>
<td style="text-align: right;">1692</td>
<td style="text-align: right;">12.70</td>
<td style="text-align: right;">67.46</td>
<td style="text-align: right;">22.41</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.96</td>
<td style="text-align: right;">35.14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17.57</td>
<td style="text-align: right;">14.23</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1985</td>
<td style="text-align: right;">1762</td>
<td style="text-align: right;">1613</td>
<td style="text-align: right;">12.91</td>
<td style="text-align: right;">70.53</td>
<td style="text-align: right;">21.90</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.01</td>
<td style="text-align: right;">34.60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17.54</td>
<td style="text-align: right;">14.72</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1986</td>
<td style="text-align: right;">1630</td>
<td style="text-align: right;">1642</td>
<td style="text-align: right;">12.80</td>
<td style="text-align: right;">68.31</td>
<td style="text-align: right;">22.36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.76</td>
<td style="text-align: right;">33.83</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17.70</td>
<td style="text-align: right;">14.95</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1987</td>
<td style="text-align: right;">1912</td>
<td style="text-align: right;">1600</td>
<td style="text-align: right;">13.47</td>
<td style="text-align: right;">71.13</td>
<td style="text-align: right;">22.38</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.45</td>
<td style="text-align: right;">32.20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17.88</td>
<td style="text-align: right;">14.32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1988</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">1636</td>
<td style="text-align: right;">13.30</td>
<td style="text-align: right;">69.76</td>
<td style="text-align: right;">22.56</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.69</td>
<td style="text-align: right;">35.42</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18.10</td>
<td style="text-align: right;">15.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1789</td>
<td style="text-align: right;">1582</td>
<td style="text-align: right;">12.92</td>
<td style="text-align: right;">69.70</td>
<td style="text-align: right;">22.06</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.17</td>
<td style="text-align: right;">32.86</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17.50</td>
<td style="text-align: right;">14.73</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>Long-term average power</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(power_ltavg) <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total.Rain.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total.ETo.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">S.Humid.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Humid.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Mean.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Mean.N.30.Days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Mean.N.35.Days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Max.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Max</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Max.N.40.Days</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Min.Mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Min</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total.Rain.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total.ETo.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">S.Humid.Mean.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Humid.Mean.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Mean.Mean.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Mean.N.30.Days.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Max.Mean.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Max.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Max.N.40.Days.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Min.Mean.sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Temp.Min.sd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">1814.49</td>
<td style="text-align: right;">1625.00</td>
<td style="text-align: right;">13.34</td>
<td style="text-align: right;">70.12</td>
<td style="text-align: right;">22.53</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.60</td>
<td style="text-align: right;">34.23</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18.10</td>
<td style="text-align: right;">14.59</td>
<td style="text-align: right;">345.70</td>
<td style="text-align: right;">69.05</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">2.71</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">1.49</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.81</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0108 36.9617 B250</td>
<td style="text-align: right;">1218.59</td>
<td style="text-align: right;">1421.90</td>
<td style="text-align: right;">10.62</td>
<td style="text-align: right;">70.84</td>
<td style="text-align: right;">17.74</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">24.85</td>
<td style="text-align: right;">29.40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">11.87</td>
<td style="text-align: right;">8.17</td>
<td style="text-align: right;">298.93</td>
<td style="text-align: right;">86.31</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">3.58</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">1.35</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0333 34.8000 B917</td>
<td style="text-align: right;">1864.63</td>
<td style="text-align: right;">1681.07</td>
<td style="text-align: right;">13.38</td>
<td style="text-align: right;">67.85</td>
<td style="text-align: right;">23.05</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.37</td>
<td style="text-align: right;">33.28</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">19.13</td>
<td style="text-align: right;">15.10</td>
<td style="text-align: right;">358.39</td>
<td style="text-align: right;">70.68</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.95</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0333 37.8333 B917</td>
<td style="text-align: right;">1184.73</td>
<td style="text-align: right;">1345.34</td>
<td style="text-align: right;">10.95</td>
<td style="text-align: right;">74.56</td>
<td style="text-align: right;">17.30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">23.57</td>
<td style="text-align: right;">27.92</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12.59</td>
<td style="text-align: right;">9.16</td>
<td style="text-align: right;">297.46</td>
<td style="text-align: right;">85.20</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">3.40</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">1.13</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.84</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0420 34.5920 B12500</td>
<td style="text-align: right;">1814.49</td>
<td style="text-align: right;">1619.80</td>
<td style="text-align: right;">13.34</td>
<td style="text-align: right;">70.12</td>
<td style="text-align: right;">22.53</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.60</td>
<td style="text-align: right;">34.23</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18.10</td>
<td style="text-align: right;">14.59</td>
<td style="text-align: right;">345.70</td>
<td style="text-align: right;">69.41</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">2.71</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">1.49</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.81</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0620 34.2290 B30000</td>
<td style="text-align: right;">1873.51</td>
<td style="text-align: right;">1631.00</td>
<td style="text-align: right;">13.68</td>
<td style="text-align: right;">69.94</td>
<td style="text-align: right;">22.98</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26.99</td>
<td style="text-align: right;">32.85</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">19.32</td>
<td style="text-align: right;">15.93</td>
<td style="text-align: right;">344.15</td>
<td style="text-align: right;">65.83</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">2.25</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.78</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</section>
</section>
<section id="soilgrids" class="level3" data-number="1.8.3">
<h3 data-number="1.8.3" class="anchored" data-anchor-id="soilgrids"><span class="header-section-number">1.8.3</span> Soilgrids</h3>
<section id="access-2" class="level4" data-number="1.8.3.1">
<h4 data-number="1.8.3.1" class="anchored" data-anchor-id="access-2"><span class="header-section-number">1.8.3.1</span> Access</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the remote S3 path and local save path</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>s3_data_dir <span class="ot">&lt;-</span> <span class="st">"s3://digital-atlas/era/geodata"</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># List and filter files</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>s3<span class="ot">&lt;-</span>s3fs<span class="sc">::</span>S3FileSystem<span class="sc">$</span><span class="fu">new</span>(<span class="at">anonymous =</span> T)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>files_s3<span class="ot">&lt;-</span>files_s3[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"watbal"</span>,files_s3)]</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>file_soilgrids<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"soilgrids2.0.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>file_isda<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"isda.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to most recent version of dataset</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>(file_soilgrids <span class="ot">&lt;-</span> <span class="fu">tail</span>(file_soilgrids, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/soilgrids2.0_2025-04-11.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>(file_isda <span class="ot">&lt;-</span> <span class="fu">tail</span>(file_isda, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/isda_2025-04-12.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>files_s3<span class="ot">&lt;-</span><span class="fu">c</span>(file_isda,file_soilgrids)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create local file path and download</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, files_s3)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(files_local)){</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local[i])){</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    s3<span class="sc">$</span><span class="fu">file_download</span>(files_s3[i], files_local[i])</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the soilgrids data is quite large (&gt;150 Mb) so it will take a few minutes to download</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>soilgrids<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local[<span class="dv">1</span>])</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>isda<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="structure-2" class="level4" data-number="1.8.3.2">
<h4 data-number="1.8.3.2" class="anchored" data-anchor-id="structure-2"><span class="header-section-number">1.8.3.2</span> Structure</h4>
<p><strong>Soil grids</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(soilgrids) <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">stat</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">variable</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">depth</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">error</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">mean</td>
<td style="text-align: left;">al</td>
<td style="text-align: left;">0-20cm</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">267.75</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">mean</td>
<td style="text-align: left;">al</td>
<td style="text-align: left;">20-50cm</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">321.87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">mean</td>
<td style="text-align: left;">bdr</td>
<td style="text-align: left;">0-200cm</td>
<td style="text-align: right;">21.1</td>
<td style="text-align: right;">200.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">mean</td>
<td style="text-align: left;">c.tot</td>
<td style="text-align: left;">0-20cm</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">22.91</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">mean</td>
<td style="text-align: left;">c.tot</td>
<td style="text-align: left;">20-50cm</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.78</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: left;">mean</td>
<td style="text-align: left;">ca</td>
<td style="text-align: left;">0-20cm</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">933.95</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>(files_s3<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"soilgrids2.0.*metadata"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/soilgrids2.0_metadata.csv"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace s3 path with https path so we can read directly into R</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>http_path <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^s3://([^/]+)/(.*)$"</span>, <span class="st">"https://</span><span class="sc">\\</span><span class="st">1.s3.amazonaws.com/</span><span class="sc">\\</span><span class="st">2"</span>, files_s3)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>soilgrids_metadata<span class="ot">&lt;-</span><span class="fu">fread</span>(http_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(soilgrids_metadata) <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Name</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Description</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Mapped units</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Conversion factor</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Conventional units</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">source</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">resolution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bdod</td>
<td style="text-align: left;">Bulk density of the fine earth fraction</td>
<td style="text-align: left;">cg/cm^3</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;">kg/dm^3</td>
<td style="text-align: left;">SoilGrids 2.0</td>
<td style="text-align: left;">250m</td>
</tr>
<tr class="even">
<td style="text-align: left;">cec</td>
<td style="text-align: left;">Cation Exchange Capacity of the soil</td>
<td style="text-align: left;">mmol(c)/kg</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">cmol(c)/kg</td>
<td style="text-align: left;">SoilGrids 2.0</td>
<td style="text-align: left;">250m</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cfvo</td>
<td style="text-align: left;">Volumetric fraction of coarse fragments (&gt; 2 mm)</td>
<td style="text-align: left;">cm^3/dm^3 (vol per mil)</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">cm^3/100cm^3 (vol%)</td>
<td style="text-align: left;">SoilGrids 2.0</td>
<td style="text-align: left;">250m</td>
</tr>
<tr class="even">
<td style="text-align: left;">clay</td>
<td style="text-align: left;">Proportion of clay particles (&lt; 0.002 mm) in the fine earth fraction</td>
<td style="text-align: left;">g/kg</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">g/100g (%)</td>
<td style="text-align: left;">SoilGrids 2.0</td>
<td style="text-align: left;">250m</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nitrogen</td>
<td style="text-align: left;">Total nitrogen (N)</td>
<td style="text-align: left;">cg/kg</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;">g/kg</td>
<td style="text-align: left;">SoilGrids 2.0</td>
<td style="text-align: left;">250m</td>
</tr>
<tr class="even">
<td style="text-align: left;">phh2o</td>
<td style="text-align: left;">Soil pH</td>
<td style="text-align: left;">pH*10</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">pH</td>
<td style="text-align: left;">SoilGrids 2.0</td>
<td style="text-align: left;">250m</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>isda</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(isda) <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">variable</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">value</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">depth</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">stat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bdod</td>
<td style="text-align: right;">1.230000</td>
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: left;">0-5cm</td>
<td style="text-align: left;">mean</td>
</tr>
<tr class="even">
<td style="text-align: left;">bdod</td>
<td style="text-align: right;">1.210476</td>
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: left;">0-5cm</td>
<td style="text-align: left;">mean</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bdod</td>
<td style="text-align: right;">1.210000</td>
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: left;">0-5cm</td>
<td style="text-align: left;">mean</td>
</tr>
<tr class="even">
<td style="text-align: left;">bdod</td>
<td style="text-align: right;">1.230000</td>
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: left;">0-5cm</td>
<td style="text-align: left;">mean</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bdod</td>
<td style="text-align: right;">1.220114</td>
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: left;">0-5cm</td>
<td style="text-align: left;">mean</td>
</tr>
<tr class="even">
<td style="text-align: left;">bdod</td>
<td style="text-align: right;">1.200457</td>
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: left;">0-5cm</td>
<td style="text-align: left;">mean</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .mapply(list, x, NULL): longer argument not a multiple of length of
shorter</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>files_s3<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"isda.*metadata"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace s3 path with https path so we can read directly into R</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>http_path <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^s3://([^/]+)/(.*)$"</span>, <span class="st">"https://</span><span class="sc">\\</span><span class="st">1.s3.amazonaws.com/</span><span class="sc">\\</span><span class="st">2"</span>, files_s3)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>isda_metadata<span class="ot">&lt;-</span><span class="fu">fread</span>(http_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(isda_metadata) <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">var</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">description</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">al</td>
<td style="text-align: left;">extractable aluminum</td>
<td style="text-align: left;">mg kg-1</td>
</tr>
<tr class="even">
<td style="text-align: left;">bdr</td>
<td style="text-align: left;">bed rock depth</td>
<td style="text-align: left;">cm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">clay</td>
<td style="text-align: left;">clay content</td>
<td style="text-align: left;">%</td>
</tr>
<tr class="even">
<td style="text-align: left;">c.tot</td>
<td style="text-align: left;">total carbon</td>
<td style="text-align: left;">kg-1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ca</td>
<td style="text-align: left;">extractable calcium</td>
<td style="text-align: left;">mg kg-1</td>
</tr>
<tr class="even">
<td style="text-align: left;">db.od</td>
<td style="text-align: left;">bulk density</td>
<td style="text-align: left;">kg m-3</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</section>
</section>
<section id="elevation" class="level3" data-number="1.8.4">
<h3 data-number="1.8.4" class="anchored" data-anchor-id="elevation"><span class="header-section-number">1.8.4</span> Elevation</h3>
<section id="access-3" class="level4" data-number="1.8.4.1">
<h4 data-number="1.8.4.1" class="anchored" data-anchor-id="access-3"><span class="header-section-number">1.8.4.1</span> Access</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>files_s3<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"elevation.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>(files_s3 <span class="ot">&lt;-</span> <span class="fu">tail</span>(files_s3, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/elevation_2025-04-12.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create local file path and download</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, files_s3)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local)){</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    s3<span class="sc">$</span><span class="fu">file_download</span>(files_s3, files_local)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "downloaded_data/elevation_2025-04-12.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>elevation<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="structure-3" class="level4" data-number="1.8.4.2">
<h4 data-number="1.8.4.2" class="anchored" data-anchor-id="structure-3"><span class="header-section-number">1.8.4.2</span> Structure</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(elevation) <span class="sc">|&gt;</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Latitude</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Longitude</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Buffer</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Country</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">variable</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">stat</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">34.5939</td>
<td style="text-align: right;">300</td>
<td style="text-align: left;">Kenya</td>
<td style="text-align: left;">slope</td>
<td style="text-align: left;">mean</td>
<td style="text-align: right;">5.043176</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">34.5939</td>
<td style="text-align: right;">300</td>
<td style="text-align: left;">Kenya</td>
<td style="text-align: left;">slope</td>
<td style="text-align: left;">sd</td>
<td style="text-align: right;">2.824392</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">34.5939</td>
<td style="text-align: right;">300</td>
<td style="text-align: left;">Kenya</td>
<td style="text-align: left;">slope</td>
<td style="text-align: left;">median</td>
<td style="text-align: right;">4.544371</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">34.5939</td>
<td style="text-align: right;">300</td>
<td style="text-align: left;">Kenya</td>
<td style="text-align: left;">slope</td>
<td style="text-align: left;">max</td>
<td style="text-align: right;">15.812020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">34.5939</td>
<td style="text-align: right;">300</td>
<td style="text-align: left;">Kenya</td>
<td style="text-align: left;">slope</td>
<td style="text-align: left;">min</td>
<td style="text-align: right;">0.000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">34.5939</td>
<td style="text-align: right;">300</td>
<td style="text-align: left;">Kenya</td>
<td style="text-align: left;">aspect</td>
<td style="text-align: left;">mean</td>
<td style="text-align: right;">227.078533</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>Field Descriptions:</strong></p>
<ul>
<li><code>Site.Key</code>: Unique identifier for the ERA site.<br>
</li>
<li><code>Latitude</code>: Geographic latitude of the site (decimal degrees, WGS84).<br>
</li>
<li><code>Longitude</code>: Geographic longitude of the site (decimal degrees, WGS84).<br>
</li>
<li><code>Buffer</code>: Radius (in meters) around the site used for calculating topographic statistics.<br>
</li>
<li><code>Country</code>: Country in which the site is located.<br>
</li>
<li><code>variable</code>: The terrain variable being summarized:
<ul>
<li><code>elevation</code>: Elevation above sea level (meters)<br>
</li>
<li><code>slope</code>: Terrain slope or steepness (degrees)<br>
</li>
<li><code>aspect</code>: Orientation of slope (degrees clockwise from North)<br>
</li>
</ul></li>
<li><code>stat</code>: Summary statistic applied to the variable within the buffer:
<ul>
<li><code>mean</code>: Mean value<br>
</li>
<li><code>sd</code>: Standard deviation<br>
</li>
<li><code>median</code>: Median value<br>
</li>
<li><code>max</code>: Maximum value<br>
</li>
<li><code>min</code>: Minimum value<br>
</li>
</ul></li>
<li><code>value</code>: The computed result for each <code>variable</code>–<code>stat</code> combination.</li>
</ul>
</section>
</section>
<section id="sos" class="level3" data-number="1.8.5">
<h3 data-number="1.8.5" class="anchored" data-anchor-id="sos"><span class="header-section-number">1.8.5</span> SOS</h3>
<section id="access-4" class="level4" data-number="1.8.5.1">
<h4 data-number="1.8.5.1" class="anchored" data-anchor-id="access-4"><span class="header-section-number">1.8.5.1</span> Access</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>files_s3<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"sos_.*RData"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>(files_s3 <span class="ot">&lt;-</span> <span class="fu">tail</span>(files_s3, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/sos_2025-04-13.RData"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, files_s3)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co"># File size is about 40 MB, so download will take some time depending on your connection</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local)){</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    s3<span class="sc">$</span><span class="fu">file_download</span>(files_s3, files_local)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "downloaded_data/sos_2025-04-13.RData"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load sos data</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>sos<span class="ot">&lt;-</span>miceadds<span class="sc">::</span><span class="fu">load.Rdata2</span>(<span class="at">file=</span><span class="fu">basename</span>(files_local),<span class="at">path=</span><span class="fu">dirname</span>(files_local))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Dekadal_SOS"   "Seasonal_SOS2" "LTAvg_SOS2"    "Seasonal_SOS3"
[5] "LTAvg_SOS3"   </code></pre>
</div>
</div>
</section>
<section id="structure-4" class="level4" data-number="1.8.5.2">
<h4 data-number="1.8.5.2" class="anchored" data-anchor-id="structure-4"><span class="header-section-number">1.8.5.2</span> Structure</h4>
<p>The start of season (sos) calculations <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/calculate_sos.R">/R/add_geodata/calculate_sos.R</a> process raw climate data to derive robust growing-season indicators at multiple temporal scales. In essence, it integrates high-resolution (dekadal) climate records with monthly and seasonal aggregations to compute metrics such as the start of season (SOS), end of season (EOS), length of growing period (LGP), and total rainfall. This multi-layered approach is designed for informed agricultural planning and climate adaptation analysis.</p>
<p>We do not provide detailed descriptions of all the field present in the sos tables, this can be found in the metadata table. The table we make use of the climate statistic calculations is <code>sos$LTAvg_SOS2</code> which tells on the average onset of the rainy season (in dekads) for a location.</p>
<ol start="0" type="1">
<li><code>metadata</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>files_s3<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"sos.*metadata.*csv"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>(files_s3 <span class="ot">&lt;-</span> <span class="fu">tail</span>(files_s3, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/sos_metadata.csv"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace s3 path with https path so we can read directly into R</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>http_path <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^s3://([^/]+)/(.*)$"</span>, <span class="st">"https://</span><span class="sc">\\</span><span class="st">1.s3.amazonaws.com/</span><span class="sc">\\</span><span class="st">2"</span>, files_s3)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>sos_metadata<span class="ot">&lt;-</span><span class="fu">fread</span>(http_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sos_metadata) <span class="sc">|&gt;</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Table</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Field</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Class</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dekadal_SOS</td>
<td style="text-align: left;">Site.Key</td>
<td style="text-align: left;">chr</td>
<td style="text-align: left;">Unique identifier for the site.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dekadal_SOS</td>
<td style="text-align: left;">Year</td>
<td style="text-align: left;">num</td>
<td style="text-align: left;">The calendar year corresponding to the record.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dekadal_SOS</td>
<td style="text-align: left;">Dekad</td>
<td style="text-align: left;">num</td>
<td style="text-align: left;">The 10-day period number within the year (typically 1–36).</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dekadal_SOS</td>
<td style="text-align: left;">Rain.Season</td>
<td style="text-align: left;">num</td>
<td style="text-align: left;">Code indicating the identified rainy season for that dekad.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dekadal_SOS</td>
<td style="text-align: left;">Rain.Dekad</td>
<td style="text-align: left;">num</td>
<td style="text-align: left;">Total rainfall measured during the dekad.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dekadal_SOS</td>
<td style="text-align: left;">AI</td>
<td style="text-align: left;">num</td>
<td style="text-align: left;">Aridity Index (ratio of rainfall to potential evapotranspiration) for the dekad.</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<ol type="1">
<li><code>Dekadal_SOS</code>
<ul>
<li><strong>Description:</strong> Contains detailed, dekadal (approximately 10-day) climate information.<br>
</li>
<li><strong>Key Metrics:</strong> Rainfall, potential evapotranspiration (ETo), aridity index (AI), and computed dekad values.<br>
</li>
<li><strong>Purpose:</strong> Provides the high-resolution temporal detail needed to identify seasonal transitions and establish baseline climate conditions.</li>
</ul></li>
<li><code>Seasonal_SOS2</code>
<ul>
<li><strong>Description:</strong> Aggregates dekadal data into a seasonal view focused on the primary growing season.<br>
</li>
<li><strong>Key Metrics:</strong>
<ul>
<li><strong>SOS:</strong> The first dekad when conditions indicate the start of the season.<br>
</li>
<li><strong>EOS:</strong> The last dekad of the season.<br>
</li>
<li><strong>LGP:</strong> The length of the growing period (calculated as the difference between EOS and SOS).<br>
</li>
<li><strong>Tot.Rain:</strong> Total rainfall during the season.<br>
</li>
</ul></li>
<li><strong>Methodology:</strong> Uses rolling sums and fixed threshold criteria (e.g., minimum rainfall, aridity conditions) to define the rainy period, with padding applied to manage edge effects.</li>
</ul></li>
</ol>
<p>3.<code>LTAvg_SOS2</code> - <strong>Description:</strong> Provides long-term average statistics derived from the primary seasonal data.<br>
- <strong>Key Metrics:</strong><br>
- Mean, median, minimum, and maximum SOS values.<br>
- Average EOS, LGP, and average total seasonal rainfall (mean seasonal precipitation MSP).<br>
- Proportions indicating seasonal transitions across calendar years. - <strong>Purpose:</strong> Summarizes seasonal behavior over the full record, highlighting variability and central tendencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sos<span class="sc">$</span>LTAvg_SOS2[,.(Site.Key,SOS.min,SOS.mean,SOS.max,EOS,LGP,Tot.Rain,Seasons)]) <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">SOS.min</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">SOS.mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">SOS.max</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">EOS</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">LGP</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Tot.Rain</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Seasons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5.6</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">12.4</td>
<td style="text-align: right;">859.1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22.6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">13.4</td>
<td style="text-align: right;">751.4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0108 36.9617 B250</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">7.9</td>
<td style="text-align: right;">309.5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0108 36.9617 B250</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">29.3</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">6.7</td>
<td style="text-align: right;">236.6</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-0.0333 34.8000 B917</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5.5</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">12.5</td>
<td style="text-align: right;">817.3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">-0.0333 34.8000 B917</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">22.5</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">13.5</td>
<td style="text-align: right;">690.4</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<ol start="4" type="1">
<li><code>Seasonal_SOS3 &amp; LTAvg_SOS3</code>
<ul>
<li><strong>Description:</strong> These datasets mirror Seasonal_SOS2 and LTAvg_SOS2 but pertain to an additional (often secondary) growing season, which may be present in more humid regions.<br>
</li>
<li><strong>Key Metrics &amp; Purpose:</strong> Similar to the primary season outputs, these capture SOS, EOS, LGP, and rainfall for the secondary season, adding nuance to regions where multiple growing periods exist.</li>
</ul></li>
</ol>
</section>
<section id="methods-1" class="level4" data-number="1.8.5.3">
<h4 data-number="1.8.5.3" class="anchored" data-anchor-id="methods-1"><span class="header-section-number">1.8.5.3</span> Methods</h4>
<p><a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/calculate_sos.R">/R/add_geodata/calculate_sos.R</a></p>
<ul>
<li><p><strong>Data Integration:</strong> The script merges datasets from the POWER and CHIRPS sources—substituting CHIRPS rainfall into the POWER dataset—to leverage the strengths of both and ensure more accurate rainfall data.</p></li>
<li><p><strong>Temporal Aggregation:</strong> Daily data are first converted to dekadal values. These are further aggregated into monthly summaries and then into seasonal periods using custom functions (e.g., <code>SOS_Dekad</code>, <code>SOS_SeasonPad</code>).</p></li>
<li><p><strong>Threshold-Based Filtering:</strong> Fixed criteria (e.g., a minimum rainfall threshold of 200 mm, an aridity index cutoff) are applied to delineate season boundaries. While these thresholds are clearly defined, they prompt a critical question: are they universally applicable, or do they require recalibration for different regions and evolving climate conditions?</p></li>
<li><p><strong>Handling Season Transitions:</strong> The script manages scenarios where seasons cross calendar boundaries, excludes incomplete years, and applies specific padding rules to balance season lengths. Custom sequence functions (e.g., <code>SOS_UniqueSeq</code>, <code>SOS_SeqMerge</code>) play a key role in ensuring the integrity of the seasonal identification.</p></li>
</ul>
<p><strong>Critical Considerations &amp; Forward-Thinking Perspective</strong></p>
<ul>
<li><p><strong>Fixed Parameters vs.&nbsp;Regional Flexibility:</strong> The use of fixed thresholds (for rainfall and aridity) is straightforward but invites scrutiny. It is important to ask whether these parameters are optimal for all regions, especially in a changing climate. Future iterations might consider adaptive or region-specific thresholds.</p></li>
<li><p><strong>Modular and Adaptable Structure:</strong> The script’s modular design—with separate outputs for dekadal details, seasonal summaries, and long-term averages—allows for flexibility. This structure facilitates updates and refinements, such as integrating more dynamic statistical methods or machine learning approaches to adjust thresholds.</p></li>
<li><p><strong>Robustness in Data Quality:</strong> Steps to exclude incomplete data and adjust for season transitions add robustness, but constant validation against observed ground conditions is critical for long-term reliability.</p></li>
</ul>
<p>The output datasets provide a comprehensive picture of growing season dynamics: - <strong>Dekadal_SOS</strong> offers a fine-scale temporal resolution. - <strong>Seasonal_SOS2</strong> and <strong>LTAvg_SOS2</strong> capture the primary and secondary growing season’s characteristics. - <strong>Seasonal_SOS3</strong> and <strong>LTAvg_SOS3</strong> extend this analysis to potential thrid season.</p>
<p>This structure supports detailed analysis and decision-making in agricultural and climate adaptation planning. However, while the methodology is thorough, questioning the fixed thresholds and continuously validating the approach against real-world data remains essential for maintaining relevance in a forward-thinking, dynamic climate context.</p>
</section>
</section>
<section id="aez" class="level3" data-number="1.8.6">
<h3 data-number="1.8.6" class="anchored" data-anchor-id="aez"><span class="header-section-number">1.8.6</span> AEZ</h3>
<section id="access-5" class="level4" data-number="1.8.6.1">
<h4 data-number="1.8.6.1" class="anchored" data-anchor-id="access-5"><span class="header-section-number">1.8.6.1</span> Access</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>files_s3<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"aez_.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>(files_s3 <span class="ot">&lt;-</span> <span class="fu">tail</span>(files_s3, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/aez_2025-04-11.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, files_s3)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local)){</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    s3<span class="sc">$</span><span class="fu">file_download</span>(files_s3, files_local)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "downloaded_data/aez_2025-04-11.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>aez<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="structure-5" class="level4" data-number="1.8.6.2">
<h4 data-number="1.8.6.2" class="anchored" data-anchor-id="structure-5"><span class="header-section-number">1.8.6.2</span> Structure</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aez) <span class="sc">|&gt;</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Latitude</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Longitude</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Buffer</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">prop</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">value</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">dataset</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">value_cat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-0.0023</td>
<td style="text-align: right;">34.5939</td>
<td style="text-align: left;">-0.0023 34.5939 B300</td>
<td style="text-align: right;">300</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">324</td>
<td style="text-align: left;">004_afr-aez_09.tif</td>
<td style="text-align: left;">Tropic - cool / humid</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.0108</td>
<td style="text-align: right;">36.9617</td>
<td style="text-align: left;">-0.0108 36.9617 B250</td>
<td style="text-align: right;">250</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">323</td>
<td style="text-align: left;">004_afr-aez_09.tif</td>
<td style="text-align: left;">Tropic - cool / subhumid</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-0.0333</td>
<td style="text-align: right;">34.8000</td>
<td style="text-align: left;">-0.0333 34.8000 B917</td>
<td style="text-align: right;">917</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">324</td>
<td style="text-align: left;">004_afr-aez_09.tif</td>
<td style="text-align: left;">Tropic - cool / humid</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.0333</td>
<td style="text-align: right;">37.8333</td>
<td style="text-align: left;">-0.0333 37.8333 B917</td>
<td style="text-align: right;">917</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">313</td>
<td style="text-align: left;">004_afr-aez_09.tif</td>
<td style="text-align: left;">Tropic - warm / subhumid</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-0.0420</td>
<td style="text-align: right;">34.5920</td>
<td style="text-align: left;">-0.0420 34.5920 B12500</td>
<td style="text-align: right;">12500</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: left;">324</td>
<td style="text-align: left;">004_afr-aez_09.tif</td>
<td style="text-align: left;">Tropic - cool / humid</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.0620</td>
<td style="text-align: right;">34.2290</td>
<td style="text-align: left;">-0.0620 34.2290 B30000</td>
<td style="text-align: right;">30000</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: left;">314</td>
<td style="text-align: left;">004_afr-aez_09.tif</td>
<td style="text-align: left;">Tropic - warm / humid</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p><strong>Field Descriptions:</strong></p>
<ul>
<li><code>Latitude</code>: Geographic latitude of the site (decimal degrees, WGS84).<br>
</li>
<li><code>Longitude</code>: Geographic longitude of the site (decimal degrees, WGS84).<br>
</li>
<li><code>Site.Key</code>: Unique site identifier used throughout ERA.<br>
</li>
<li><code>Buffer</code>: Radius (in meters) used to extract AEZ values from raster data.<br>
</li>
<li><code>prop</code>: Proportion of the buffer area covered by the dominant AEZ category.<br>
</li>
<li><code>value</code>: Numeric AEZ class code assigned by the source dataset.<br>
</li>
<li><code>dataset</code>: The AEZ raster dataset used, e.g., <code>"004_afr-aez_09.tif"</code> or <code>"AEZ8_CLAS--SSA.tif"</code>.<br>
</li>
<li><code>value_cat</code>: Human-readable label for the AEZ zone, derived from the class value using an external key or metadata file (e.g., <code>"Tropic - cool / humid"</code>).</li>
</ul>
</section>
</section>
<section id="soil-moisture" class="level3" data-number="1.8.7">
<h3 data-number="1.8.7" class="anchored" data-anchor-id="soil-moisture"><span class="header-section-number">1.8.7</span> Soil Moisture</h3>
<p>Daily soil moisture balance is calculated using a simple water balance model implemented in <a href="https://github.com/CIAT/ERA_dev/blob/main/R/add_geodata/water_balance.R"><code>water_balance.R</code></a>.<br>
This model simulates <strong>daily soil water availability</strong>, <strong>evaporative demand</strong>, and <strong>logging risk</strong> for each site, based on rainfall (CHIRPS), temperature and radiation (NASA POWER), and soil properties derived from ISDA (Africa) or SoilGrids 2.0 (non-Africa). These daily values are the foundation for seasonal summaries of <strong>water stress</strong> (<code>ERATIO</code>) and <strong>excess moisture</strong> (<code>LOGGING</code>).</p>
<ul>
<li><strong><code>ERATIO</code></strong> (Evaporative Ratio) is the ratio of actual evapotranspiration (Ea) to potential evapotranspiration (Ep).
<ul>
<li>Values near <strong>1</strong> indicate sufficient water availability—plants are able to meet atmospheric demand.<br>
</li>
<li>Values <strong>&lt; 0.5</strong> suggest <strong>moderate to severe water stress</strong>, where crop water needs are not being met.<br>
</li>
<li>Daily <code>ERATIO</code> values are used to summarize <strong>frequency, duration, and intensity</strong> of drought conditions across a season.</li>
</ul></li>
<li><strong><code>LOGGING</code></strong> represents the amount of water in the soil <strong>above field capacity but below saturation</strong>.
<ul>
<li>Positive values indicate periods where <strong>excess water</strong> may restrict oxygen availability to roots (i.e., waterlogging).<br>
</li>
<li>Used to flag <strong>moisture stress due to excess rainfall or poor drainage</strong>.</li>
</ul></li>
</ul>
<section id="access-6" class="level4" data-number="1.8.7.1">
<h4 data-number="1.8.7.1" class="anchored" data-anchor-id="access-6"><span class="header-section-number">1.8.7.1</span> Access</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>files_s3 <span class="ot">&lt;-</span> s3<span class="sc">$</span><span class="fu">dir_ls</span>(s3_data_dir)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Substitute isda for soilgrids to access the isda soil grids data (for african site)</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Hear we are using soilgrids2.0 because the file size is more convinient for this vignette</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>files_s3<span class="ot">&lt;-</span><span class="fu">grep</span>(<span class="st">"watbal.*soilgrids.*parquet"</span>, files_s3, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>(files_s3 <span class="ot">&lt;-</span> <span class="fu">tail</span>(files_s3, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s3://digital-atlas/era/geodata/watbal-soilgrids2.0_2025-04-13.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>files_local <span class="ot">&lt;-</span> <span class="fu">gsub</span>(s3_data_dir, local_data_dir, files_s3)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># File size is about x MB, so download will take some time depending on your connection</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(files_local)){</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    s3<span class="sc">$</span><span class="fu">file_download</span>(files_s3, files_local)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "downloaded_data/watbal-soilgrids2.0_2025-04-13.parquet"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>watbal<span class="ot">&lt;-</span>arrow<span class="sc">::</span><span class="fu">read_parquet</span>(files_local)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="structure-6" class="level4" data-number="1.8.7.2">
<h4 data-number="1.8.7.2" class="anchored" data-anchor-id="structure-6"><span class="header-section-number">1.8.7.2</span> Structure</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(watbal) <span class="sc">|&gt;</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">|&gt;</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">|&gt;</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"250px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:250px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Site.Key</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">scp</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">ssat</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">DATE</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">TMIN</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">TMAX</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">TMEAN</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">RAIN</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">SRAD</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">ETMAX</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">AVAIL</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">DEMAND</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">ERATIO</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">LOGGING</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">RUNOFF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: right;">32.29</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: left;">1984-01-01</td>
<td style="text-align: right;">22.5</td>
<td style="text-align: right;">30.3</td>
<td style="text-align: right;">25.4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">19.1</td>
<td style="text-align: right;">6.62</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: right;">32.29</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: left;">1984-01-02</td>
<td style="text-align: right;">22.2</td>
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">25.5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">15.6</td>
<td style="text-align: right;">5.49</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: right;">32.29</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: left;">1984-01-03</td>
<td style="text-align: right;">22.6</td>
<td style="text-align: right;">29.2</td>
<td style="text-align: right;">25.0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17.6</td>
<td style="text-align: right;">5.85</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: right;">32.29</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: left;">1984-01-04</td>
<td style="text-align: right;">22.6</td>
<td style="text-align: right;">27.6</td>
<td style="text-align: right;">24.5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18.4</td>
<td style="text-align: right;">5.74</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: right;">32.29</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: left;">1984-01-05</td>
<td style="text-align: right;">22.4</td>
<td style="text-align: right;">27.7</td>
<td style="text-align: right;">24.4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17.1</td>
<td style="text-align: right;">5.37</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">-1.1720 -80.3920 B400</td>
<td style="text-align: right;">32.29</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: left;">1984-01-06</td>
<td style="text-align: right;">22.5</td>
<td style="text-align: right;">28.4</td>
<td style="text-align: right;">24.7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16.9</td>
<td style="text-align: right;">5.42</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>Each row represents a unique site-day combination.</p>
<p><strong>Field Descriptions:</strong></p>
<ul>
<li><code>Site.Key</code>: Unique identifier for the ERA site.<br>
</li>
<li><code>scp</code>: Soil water holding capacity at field capacity (mm). Estimated from ISDA or SoilGrids based on pedotransfer rules.<br>
</li>
<li><code>ssat</code>: Soil saturation point (mm). Maximum amount of water the soil can hold.<br>
</li>
<li><code>DATE</code>: Observation date (daily time step).<br>
</li>
<li><code>TMIN</code>: Minimum daily air temperature (°C), from NASA POWER.<br>
</li>
<li><code>TMAX</code>: Maximum daily air temperature (°C), from NASA POWER.<br>
</li>
<li><code>TMEAN</code>: Mean daily air temperature (°C).<br>
</li>
<li><code>RAIN</code>: Daily precipitation (mm), from CHIRPS.<br>
</li>
<li><code>SRAD</code>: Surface solar radiation (MJ/m²/day), from NASA POWER.<br>
</li>
<li><code>ETMAX</code>: Potential evapotranspiration (PET, mm/day), calculated using the Priestley–Taylor method.</li>
<li><code>AVAIL</code>: Estimated soil water available to crops (mm). Simulated daily from soil and rainfall inputs.<br>
</li>
<li><code>DEMAND</code>: Crop water demand (mm). Equal to <code>ETMAX</code> if water is not limiting.<br>
</li>
<li><code>ERATIO</code>: Evaporative ratio (Ea/Ep) — actual evapotranspiration divided by PET. A proxy for crop water stress.<br>
</li>
<li><code>LOGGING</code>: Simulated waterlogging value (mm above field capacity, but below saturation).<br>
</li>
<li><code>RUNOFF</code>: Excess rainfall (mm) beyond soil saturation capacity; assumed to be lost as runoff or deep percolation.</li>
</ul>
</section>
</section>
<section id="bioclim" class="level3" data-number="1.8.8">
<h3 data-number="1.8.8" class="anchored" data-anchor-id="bioclim"><span class="header-section-number">1.8.8</span> Bioclim</h3>
<p>This will be made available in future updates. If you have a critical need for this information then please contact the ERA team and we can prioritize these data.</p>
</section>
</section>
</section>
<section id="acknowledgements" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Acknowledgements</h1>
<p>These open-source scripts were delivered for and funded by the <strong>Agroecology in the Dry Corridor of Central America (ACDC) project</strong></p>
</section>
<section id="contact-us" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Contact Us</h1>
<p>For more details or to explore collaborative opportunities:</p>
<p>Please visit our GitHub repository: <a href="https://github.com/ERAgriculture/ERA_Agronomy.git" class="uri">https://github.com/ERAgriculture/ERA_Agronomy.git</a></p>
<p>Or contact: Peter Steward (Scientist II): <a href="mailto:p.steward@cgiar.org" class="email">p.steward@cgiar.org</a><br>
Namita Joshi (Senior Research Associate): <a href="mailto:n.joshi@cgiar.org" class="email">n.joshi@cgiar.org</a><br>
Todd Rosenstock (Principal Scientist): <a href="mailto:t.rosenstock@cgiar.org" class="email">t.rosenstock@cgiar.org</a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>